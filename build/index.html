<!DOCTYPE HTML>
<html>
<head>
  <title>Evil Wood</title>
  <style>body,html{padding:0;margin:0;overflow:hidden}canvas{background-color:#1e1e0e}#a{width:2px;height:40px;position:fixed;left:50%;margin-left:-1px;top:50%;margin-top:-20px;background-color:rgba(255,255,255,.7)}#b{width:40px;height:2px;position:fixed;left:50%;margin-left:-20px;top:50%;margin-top:-1px;background-color:rgba(255,255,255,.7)}</style>
</head>
<body>
  <canvas id="scene"></canvas>
  <script>function u_convertNegZeroToPosZero(t){return 1/t==-1/0?-1*t:t}function gl_init(){context.enable(context.DEPTH_TEST)}function gl_clear(){context.viewport(0,0,canvas.width,canvas.height),context.clear(context.COLOR_BUFFER_BIT|context.DEPTH_BUFFER_BIT)}function gl_save(){var t=mat4.create();mat4.set(mvMatrix,t),mvMatrixStack.push(t)}function gl_restore(){if(0==mvMatrixStack.length)throw"Invalid popMatrix!";mvMatrix=mvMatrixStack.pop()}function gl_initShaders(){gl_initPositionShader(),gl_initTextureShader(),gl_initNormalShader(),gl_initLightingShader()}function gl_setShaderProgram(t,e){var r=context.createShader(context.FRAGMENT_SHADER);context.shaderSource(r,t),context.compileShader(r);var n=context.createShader(context.VERTEX_SHADER);context.shaderSource(n,e),context.compileShader(n),context.attachShader(shaderProgram,n),context.attachShader(shaderProgram,r),context.linkProgram(shaderProgram),context.getProgramParameter(shaderProgram,context.LINK_STATUS)||alert("Could not initialize shaders"),context.useProgram(shaderProgram),gl_initShaders()}function gl_perspective(t,e,r){mat4.perspective(t,canvas.width/canvas.height,e,r,pMatrix)}function gl_identity(){mat4.identity(mvMatrix)}function gl_translate(t,e,r){mat4.translate(mvMatrix,[t,e,r])}function gl_rotate(t,e,r,n){mat4.rotate(mvMatrix,t,[e,r,n])}function gl_scale(t,e,r){mat4.scale(mvMatrix,[t,e,r])}function gl_initPositionShader(){shaderProgram.vertexPositionAttribute=context.getAttribLocation(shaderProgram,"aVertexPosition"),context.enableVertexAttribArray(shaderProgram.vertexPositionAttribute),shaderProgram.pMatrixUniform=context.getUniformLocation(shaderProgram,"uPMatrix"),shaderProgram.mvMatrixUniform=context.getUniformLocation(shaderProgram,"uMVMatrix")}function gl_initColorShader(){shaderProgram.vertexColorAttribute=context.getAttribLocation(shaderProgram,"aVertexColor"),context.enableVertexAttribArray(shaderProgram.vertexColorAttribute)}function gl_initTextureShader(){shaderProgram.textureCoordAttribute=context.getAttribLocation(shaderProgram,"aTextureCoord"),context.enableVertexAttribArray(shaderProgram.textureCoordAttribute),shaderProgram.samplerUniform=context.getUniformLocation(shaderProgram,"uSampler")}function gl_initNormalShader(){shaderProgram.vertexNormalAttribute=context.getAttribLocation(shaderProgram,"aVertexNormal"),context.enableVertexAttribArray(shaderProgram.vertexNormalAttribute),shaderProgram.nMatrixUniform=context.getUniformLocation(shaderProgram,"uNMatrix")}function gl_initLightingShader(){shaderProgram.useLightingUniform=context.getUniformLocation(shaderProgram,"uUseLighting"),shaderProgram.ambientColorUniform=context.getUniformLocation(shaderProgram,"uAmbientColor"),shaderProgram.pointLightingLocationUniform=context.getUniformLocation(shaderProgram,"uPointLightingLocation"),shaderProgram.pointLightingColorUniform=context.getUniformLocation(shaderProgram,"uPointLightingColor")}function gl_initTexture(t,e){context.pixelStorei(context.UNPACK_FLIP_Y_WEBGL,!0),context.bindTexture(context.TEXTURE_2D,t),context.texImage2D(context.TEXTURE_2D,0,context.RGBA,context.RGBA,context.UNSIGNED_BYTE,e),context.texParameteri(context.TEXTURE_2D,context.TEXTURE_MAG_FILTER,context.NEAREST),context.texParameteri(context.TEXTURE_2D,context.TEXTURE_MIN_FILTER,context.LINEAR_MIPMAP_NEAREST),context.generateMipmap(context.TEXTURE_2D),context.bindTexture(context.TEXTURE_2D,null)}function gl_createArrayBuffer(t){var e=context.createBuffer();return e.numElements=t.length,context.bindBuffer(context.ARRAY_BUFFER,e),context.bufferData(context.ARRAY_BUFFER,new Float32Array(t),context.STATIC_DRAW),e}function gl_createElementArrayBuffer(t){var e=context.createBuffer();return e.numElements=t.length,context.bindBuffer(context.ELEMENT_ARRAY_BUFFER,e),context.bufferData(context.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),context.STATIC_DRAW),e}function gl_pushBuffers(t,e){context.bindBuffer(context.ARRAY_BUFFER,t.position),context.vertexAttribPointer(shaderProgram.vertexPositionAttribute,3,context.FLOAT,!1,0,0),context.bindBuffer(context.ARRAY_BUFFER,t.texture),context.vertexAttribPointer(shaderProgram.textureCoordAttribute,2,context.FLOAT,!1,0,0),context.activeTexture(context.TEXTURE0),context.bindTexture(context.TEXTURE_2D,e),context.uniform1i(shaderProgram.samplerUniform,0),context.bindBuffer(context.ELEMENT_ARRAY_BUFFER,t.index),context.bindBuffer(context.ARRAY_BUFFER,t.normal),context.vertexAttribPointer(shaderProgram.vertexNormalAttribute,3,context.FLOAT,!1,0,0)}function gl_setMatrixUniforms(){context.uniformMatrix4fv(shaderProgram.pMatrixUniform,!1,pMatrix),context.uniformMatrix4fv(shaderProgram.mvMatrixUniform,!1,mvMatrix);var t=mat3.create();mat4.toInverseMat3(mvMatrix,t),mat3.transpose(t),context.uniformMatrix3fv(shaderProgram.nMatrixUniform,!1,t)}function gl_drawElements(t){gl_setMatrixUniforms(),context.drawElements(context.TRIANGLES,t.index.numElements,context.UNSIGNED_SHORT,0)}function l_drawArrays(t){gl_setMatrixUniforms(),context.drawArrays(context.TRIANGLES,0,t.position.numElements/3)}function gl_enableLighting(){context.uniform1i(shaderProgram.useLightingUniform,!0)}function gl_setAmbientLighting(t,e,r){context.uniform3f(shaderProgram.ambientColorUniform,t,e,r)}function gl_setPointLighting(t,e,r){context.uniform3f(shaderProgram.pointLightingColorUniform,t,e,r)}function gl_getFragmentShaderGLSL(){return"#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec2 vTextureCoord;\nvarying vec3 vLightWeighting;\nuniform sampler2D uSampler;\nvoid main(void) {\nvec4 textureColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\ngl_FragColor = vec4(textureColor.rgb * vLightWeighting, textureColor.a);\n}"}function gl_getVertexShaderGLSL(){return"attribute vec3 aVertexPosition;\nattribute vec3 aVertexNormal;\nattribute vec2 aTextureCoord;\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nuniform mat3 uNMatrix;\nuniform vec3 uAmbientColor;\nuniform vec3 uPointLightingLocation;\nuniform vec3 uPointLightingColor;\nuniform bool uUseLighting;\nvarying vec2 vTextureCoord;\nvarying vec3 vLightWeighting;\nvoid main(void) {\nvec4 mvPosition = uMVMatrix * vec4(aVertexPosition, 1.0);\ngl_Position = uPMatrix * mvPosition;\nvTextureCoord = aTextureCoord;\nif (!uUseLighting) {\nvLightWeighting = vec3(1.0, 1.0, 1.0);\n} else {\nvec3 lightDirection = normalize(uPointLightingLocation - mvPosition.xyz);\nvec3 transformedNormal = uNMatrix * aVertexNormal;\nfloat directionalLightWeighting = max(dot(transformedNormal, lightDirection), 0.0);\nvLightWeighting = uAmbientColor + uPointLightingColor * directionalLightWeighting;\n}\n}"}function w_init(){w_addBlock(0,0),w_addBlocks()}function w_addBlock(t,e){void 0===world.blocks[t]&&(world.blocks[t]={}),world.blocks[t][e]={trees:[]};for(var r=0;r<20;r++)world.blocks[t][e].trees.push({x:45*MATH_RANDOM()*2-45,z:45*MATH_RANDOM()*2-45,rotationY:MATH_RANDOM()*MATH_PI*2,height:60+80*MATH_RANDOM()})}function w_getSurroundingBlocks(){var t=u_convertNegZeroToPosZero(MATH_ROUND(camera.x/BLOCK_SIZE)),e=u_convertNegZeroToPosZero(MATH_ROUND(camera.z/BLOCK_SIZE));return[{x:t,z:e},{x:t-1,z:e-1},{x:t,z:e-1},{x:t+1,z:e-1},{x:t+1,z:e},{x:t+1,z:e+1},{x:t,z:e+1},{x:t-1,z:e+1},{x:t-1,z:e}]}function w_addBlocks(){w_getSurroundingBlocks().forEach(function(t){var e=t.x,r=t.z;void 0===world.blocks[e]&&(world.blocks[e]={}),void 0===world.blocks[e][r]&&w_addBlock(e,r)})}function w_isNearTree(){return!0}function p_init(){player={straightMovement:0,sideMovement:0,isClimbing:!1}}function a_init(){gain.connect(audioContext.destination),gain.gain.value=0,a_playMusic()}function a_playMusic(){for(var t=0,e=[],r=0;r<30;r++)e=e.concat(THEME_MUSIC);gain.gain.value=1,e.forEach(function(r,n){var a=r[0],o=r[1],i=r[2];console.log(n+1,e.length),a_playNote(a,t,o),t+=i})}function a_playNote(t,e,r){var n=audioContext.createOscillator();n.connect(gain),n.frequency.value=t,n.type="square",n.start(audioContext.currentTime+e),n.stop(audioContext.currentTime+e+r)}function v_init(){canvas.width=window.innerWidth,canvas.height=window.innerHeight,gl_setShaderProgram(gl_getFragmentShaderGLSL(),gl_getVertexShaderGLSL()),v_loadTextures(function(){c_gameLoop()})}function v_loadTextures(t){textures={tree:{encoding:"data:image/gif;base64,R0lGODlhEAAQAPcAAAAAAP///0RIOz9AOFBRR0REOlNTS1dWPVZVQ0RDNElIOkpJO0pJPFFQQ1RTSFZVTEE/MVFPP1NRQlRSQ1dVRkZDMktINj89MUNBNlBOQUtJPVJQQ1pYS1BNPVFOQF1aS11bUVRQPlFNPVxYR0A+NVpXS15bT2ZjV0pIQEhBJ1hROElEMVtWRF5ZR0pGOFhURlBNQkdFPkA4Hk5GLUA6J0Q+K0hCLjw3J0ZBMVxWQ1NOPkhENz88MlRQQ0lBKkY/KlhPN05IODg0KVNOP1RPQGNdTEA8MUZCNkRANUZCN1lVSV5aTkZDO0c+J0I6JzEsH05GMzYxJE5HNkU/MGhfSVpTQk9JOltUQ2JbSUpFOEZBNVdSRkhEOlpVSUM3HD4zGkg+J0Y8JkxCLEpBLEU9Kz43J0E6Ki4pHktDMTo0JkI7LDs1KEA6LFVNO0dBM1tTQklDNVxUQ1BKPEA7MFZQQlZQQ0Y5Hz0zHz41I1BFLkg+KktCL1lPOkc/L1lQPkY/MTw2KlFJOUdAMj03K0tENlhQQFpSQkZANFhRQ1dQQkM+NFROQjYmCTcpEEAzGzwxHDYsGj4zHzYtHUM5JjMrHU1CLSokGU9EMDoyJDszJU1DMUc+LTcwIz01J1RJNkI6K0Q8LVpQPTUvJFNKOUc/MUE6LUlBM0Y/MlFJOlRMPVVNP1NMP1dQQ0ZBOD0xHSggEzUrGjowHycgFT0zIj40Iz40JEg9K0M5KUA3KEE4KUI5KkxCMlBGNUA4K1FHNz84LFRLPEI7Lz85LzImFT8yH0c5JDMpGkg7J0U5JzUsHkI3JkE2Jkc7KjEpHT81Jko+LUY7KzQsIEg9LVFFNEY9L1ZLOklAMzkyKExDNk9IPk5IPzMnF0I0IUAzITcsHTMpG0s8KEM2JEU4JkE1JTQrH0c7K1JFNDoxJUk/MjstHDkuIT4zJkc8LlFGOCkdDyccEDUsIjYtIzszKlFGOjcnFzgtIjgoGTszLDYmGgAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAEAAQAAAI/wAX6OgUzVwhF4qYWMn07VKVBgrAVJJGj5mUAg/GgJNzhJcgHkRUHFN3SxkUVSb4FMtVB52yalgQ7OozIdK0dqg8qKkVihsyPzl+VOjQAw8kJFpq2GgzytUwNuRS0BCQoNcdOO+++LCwphksOLLsGAMkZlYiYJS8SIoy7lyGInIYPWJgC9QGT38aOcIRq5QEKm9k6BlwBg2LKfdohSHxZE8LESsOALFWj9AQCAQi5FlkYEmWGyE0zXCGTZOvFyVMNdEFgk65Kx/wdWNAYdIzbdnseUtiKJw4DlvYLTvEihimGHOgjTuVKh2nVvEErQuGYtsmGK/K4PolzJ0oLpbIyCQzgiFZHERpnAy6FgWekhFuPgXZcYHavC4azAQiJeTXqhMOBAQAOw=="},metalFloor:{encoding:"data:image/gif;base64,R0lGODlhEAAQAPcAAAAAAP///2lkZSgmJ29tbjExMlhZXjM0NS8xMj1BQjM3Ny4vLyYsKyMmJVZbWScsKVdcWSwxLCYoJklMSSguJjg9NjM9LjI0MTM4MDM2MR4fHURFQz9GNzM3Li46HkJFPi48GTA+GiEnGDI3Ki8zKTs/NTg6NTY4MzM8Iz9ILzM6JzxCMjU4MDdDITQ6KSowHlJbPywwJERKODEzLTM1Lzo8NkNEQSo4Cio0EjxKGyoyFx0iEkJLLi4xJ0tQQE1QRjtGHjZAHURLMSQpFiAkFBETCxodETE2IysuIjs+Mi8xKRscGDk7M1RWTltcWDE4GTA2HTAzJjI1KDU3Lj0/NkpSKyouGzs/Kzk9Kjg6MEhKQDU5JDk8LCwuIyktFEJHKS0wHCEjFjU4Ji8xJB8gGkhKPVBSRTU6GDE0HiIkFkJFMCwuIDs9LkFDNTc4MSotFDc7Gzc6IldbOjM1Ij5AL0BCMjIzKkVGPklKQltcUywuFSUnEy8xGTM1IVVXPjQ1Kz9ANTQ2GCkqGCkqG0dIODo7JD0+JzY3Izk6JjY3JFRVOywsGjk5JzIyJS8vI0tLOEBAMjg4LSkpIUlJPzo6MyoqJlxcVFNTTCkpJklJRUVFQSQkIktLSCIhETY1I0hHNEE/KEdFLkNCNUA/M1dWSygmEzg1GzUzIUA+LUxKOU1MQk5NREA+LyUkHS0sJUpJQj47KktINzEvJFFOPTs5LV5bSTw6L0ZEN1RSRVRSR1xaTj08Nk5HIj88LC0rITs5L1hVR2FeUFxaUDQzLklIQzIuHTc0KC0rIjY0K15bTlhVSTUzLElHQE9NRjItHDw3Jz06MGplVEZDOWZjWTEsHTArHVdONkVAMVFLOjs3LDQxKFhTRTk2LU5KPk5LQnBuaC4nFkA7LmBcUlFJOD85LGBbUFVSS2BaThsaGG5qYkM6Ky8pH0hBNUNAO0tJRlRSTzcsHUY4JTctID86M2BbVD06NkpGQVBMSDYxLwAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAEAAQAAAI/wDXUAghhAuNA12iUIHGTdo4a9ES1OiAIUODB0kiMPAB6ZAWAxDy6JpWiQyaQvgwzXkCJ44KB2WwBcN1zMgZXvGeBXqjCE+PPsVGMWMyJlEbG8tkDYoxwR0xZI5mDFMmZpIZDiNu0WFjgcW8VSVOOLnERMGRLzBWsLliRUSaKRU4bViioYgJAnJugIFS6hQjVzOQkEDma5MEN7MQ1WnBQw0le9mIvLBFrpqxXa/ubeNjKJS8cKyUhPECKJcwVY9qxfpkChw1T7R+rduDpcmGRr3OJfPTTdsfVKngqZM0RE+nRa3qtYNF7504UtnYRbpjZ4cOKQguLEDX7Fs6Qls+uCSQQQMEjgGasnC7BsySOVBAcqTwICgIigKZflDxVs6ZKAFVBAQAOw=="},ceiling:{encoding:"data:image/gif;base64,R0lGODlhEAAQAPcAAAAAAP///09gF0tXFVNgGUFKF1FcFkBID1hiFUhRE0ZOC0xUD01VEkdNE19oGk9WF1VdDkFGCzc7CjtAC1RbEGFpEzM3ClRaEzg8DU5TFVFWF1NZHEFFFmpwJD9DCjs+C1NYEVNXEk1SEj9CD0pOFnl+JVldHE9TG1daEVteE05REUlMEERHD1xfFUdJE2ltHVRWF0lLFVlcGl9iHFNVG2BjIFZYHVFTH0BBCT0+CT0+DVJUEkhJEFxdFUlKEUxNE11eGFtcGWprHy8wEDQ1ElpbIF9gJSEhAjAwCTg4C0pKD0VFDlNTEUlJDzs7DVdWFFVVFEREFElJFlVVGl1dHVpaHEtLGC0sBUxKElNRFkA/EUJBElBPFkFAEmRiHD08EVNRGUtJF1pYHEpJGUxLGmBeITY0CTAuCUE+DUpHEUZEE1JPF0hGFkhFFkdFF2RhImViI0VDGEZEGlNRIiEfAzMwCExHEDUyCz47Djs4DjIvDFNOFTw5D0xIFURAFE9LGExIF01JGEdDFmRfIFpVHVhTHTUxBzUxCkA7DUI9D0dCEUZBEkE8EUpFFEdCFElEFUE9E1BLGEM+FFNOHDw4Fz44DTs2DjItDElCE0E7E1lRHE9IGUU/F0I9Fjs2FFRNHVJMHU9JHEZBGldRIiUgATkyC0pCDzcxCy4pCiUhCC8qCzEsDFJJGFtSHVdOHE1GHElCG15WI1VNICwmCUM7EVlPGjQuEUtDGTkzEzEsEVNKIGJYJllQIzIqCkE4EUA4FEY9GE1EHEpBGzs0FlVLIFNJIVFIIicgBzMrDDsyEUtAF0tBHVZNKjYtED81E1RHHkc8GkU7G0k/HyAZBiUeCUw+FzMqEE1AGUQ5GkI4HDsyGUk7FjgtEkQ3GEQ5HDwwFCYeDS4lEE9AHUw+HUk9I2BSMjwuEzwvFkk6G08/H0s8IldGK1tILDouHVRCKUo4IVE/LDYoG0ExJQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAEAAQAAAI/wBvZIDxI5WFBhgc1GBgwogBAQTwOIlz7pAHJEmW8CBDwgWHARvYaJjhZZA4c6UwRaqyIoeWObFGoRBSwRGrWug0AXkCZQcIWLw2MXkh40sQU48mZdkTJhQVN8DAiCEErcuCP+s4pXnGbhcVLsxoFCLWRpQOG+UYfXgFb5ydFG+KCZIkDFs4da6q+Ukgy1kzR33MXEF16lg7d+mUoYkAiBY1PXzItUr0LV60MNI8SUiCK9MvLIvkZSvV7d01HKC8WTuzxVgwNchyrZrVy5AiX6Rscet0okifQ9OG3VJy51KlZOC0hZgyqkUQRFfgfFLRRNWjNcu29RBRpkSQBxCiHCQYAinGmEZ1jljygaCDLkp5iBQYYUUOHVWqJrBQQOFCICkjBAQAOw=="}};var e=0,r=0;for(var n in textures)!function(){r++;var a=textures[n],o=a.glTexture=context.createTexture(),i=a.image=new Image;i.onload=function(){gl_initTexture(o,i),++e>=r&&t()},i.src=a.encoding}()}function v_renderGround(t,e){gl_save(),gl_translate(t*BLOCK_SIZE,-1.1,e*BLOCK_SIZE),gl_pushBuffers(buffers.plane,textures.metalFloor.glTexture),gl_drawElements(buffers.plane),gl_restore()}function v_renderTreeTops(t,e){gl_save(),gl_translate(t*BLOCK_SIZE,25,e*BLOCK_SIZE),gl_pushBuffers(buffers.plane,textures.ceiling.glTexture),gl_drawElements(buffers.plane),gl_restore()}function v_renderTrees(t,e){for(var r=world.blocks[t][e].trees,n=0;n<r.length;n++)for(var a=r[n],o=t*BLOCK_SIZE+a.x,i=e*BLOCK_SIZE+a.z,c=0;c<a.height/2;c++)gl_save(),gl_translate(o,2*c,i),gl_rotate(a.rotationY,0,1,0),gl_pushBuffers(buffers.cube,textures.tree.glTexture),gl_drawElements(buffers.cube),gl_restore()}function v_renderBlocks(){w_getSurroundingBlocks().forEach(function(t){var e=t.x,r=t.z;v_renderGround(e,r),v_renderTrees(e,r)})}function v_updateCameraPos(){if(0!==player.straightMovement){e=(t=1===player.straightMovement?-1:1)*PLAYER_SPEED*elapsedTime/1e3;player.isClimbing?camera.y+=-1*e:(camera.z+=e*Math.cos(camera.yaw),camera.x+=e*Math.sin(camera.yaw))}if(0!==player.sideMovement){var t=1===player.sideMovement?1:-1,e=t*PLAYER_SPEED*elapsedTime/1e3;camera.z+=e*Math.cos(camera.yaw+Math.PI/2),camera.x+=e*Math.sin(camera.yaw+Math.PI/2)}}function v_render(){gl_clear(),gl_perspective(45,.1,150),gl_identity(),gl_enableLighting(),gl_setAmbientLighting(.5,.5,.5),gl_setPointLighting(.5,.5,.5),gl_rotate(-camera.pitch,1,0,0),gl_rotate(-camera.yaw,0,1,0),gl_translate(-camera.x,-camera.y,-camera.z),v_renderBlocks()}function c_init(){gl_init(),w_init(),p_init(),v_init(),a_init(),c_attachListeners()}function c_handleKeyDown(t){var e=t.which||t.keyCode;if(c_isPointerLocked())switch(e){case 65:player.sideMovement=-1;break;case 87:player.straightMovement=1;break;case 68:player.sideMovement=1;break;case 83:player.straightMovement=-1;break;case 32:player.isClimbing=!0}}function c_handleKeyUp(t){switch(t.which||t.keyCode){case 65:player.sideMovement=0;break;case 87:player.straightMovement=0;break;case 68:player.sideMovement=0;break;case 83:player.straightMovement=0}}function c_handleMouseMove(t){c_isPointerLocked()&&(camera.pitch+=t.movementY*MATH_PI*.001*-1,camera.pitch>MATH_PI/2&&(camera.pitch=MATH_PI/2),camera.pitch<-1*MATH_PI/2&&(camera.pitch=-1*MATH_PI/2),camera.yaw+=t.movementX*MATH_PI*.001*-1)}function c_isPointerLocked(){return document.pointerLockElement===canvas}function c_handleClick(t){c_isPointerLocked()||canvas.requestPointerLock()}function c_attachListeners(){document.addEventListener("keydown",function(t){c_handleKeyDown(t)},!1),document.addEventListener("keyup",function(t){c_handleKeyUp(t)},!1),document.addEventListener("mousemove",function(t){c_handleMouseMove(t)},!1),document.addEventListener("click",function(t){c_handleClick(t)},!1)}function c_gameLoop(){var t=(new Date).getTime();0!==lastTime&&(elapsedTime=t-lastTime),v_updateCameraPos(),w_addBlocks(),v_render(),lastTime=t,window.requestAnimationFrame(c_gameLoop)}glMatrixArrayType="undefined"!=typeof Float32Array?Float32Array:"undefined"!=typeof WebGLFloatArray?WebGLFloatArray:Array;var vec3={};vec3.create=function(t){var e=new glMatrixArrayType(3);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2]),e},vec3.scale=function(t,e,r){return r&&t!=r?(r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r):(t[0]*=e,t[1]*=e,t[2]*=e,t)},vec3.normalize=function(t,e){e||(e=t);var r=t[0],n=t[1],a=t[2],o=Math.sqrt(r*r+n*n+a*a);return o?1==o?(e[0]=r,e[1]=n,e[2]=a,e):(o=1/o,e[0]=r*o,e[1]=n*o,e[2]=a*o,e):(e[0]=0,e[1]=0,e[2]=0,e)};var mat3={};mat3.create=function(t){var e=new glMatrixArrayType(9);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9]),e},mat3.transpose=function(t,e){if(!e||t==e){var r=t[1],n=t[2],a=t[5];return t[1]=t[3],t[2]=t[6],t[3]=r,t[5]=t[7],t[6]=n,t[7]=a,t}return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],e};var mat4={};mat4.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},mat4.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4.create=function(t){var e=new glMatrixArrayType(16);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e},mat4.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4.toMat3=function(t,e){return e||(e=mat3.create()),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},mat4.toInverseMat3=function(t,e){var r=t[0],n=t[1],a=t[2],o=t[4],i=t[5],c=t[6],u=t[8],l=t[9],m=t[10],g=m*i-c*l,s=-m*o+c*u,x=l*o-i*u,d=r*g+n*s+a*x;return d?(d=1/d,e||(e=mat3.create()),e[0]=g*d,e[1]=(-m*n+a*l)*d,e[2]=(c*n-a*i)*d,e[3]=s*d,e[4]=(m*r-a*u)*d,e[5]=(-c*r+a*o)*d,e[6]=x*d,e[7]=(-l*r+n*u)*d,e[8]=(i*r-n*o)*d,e):null},mat4.multiply=function(t,e,r){r||(r=t);var n=t[0],a=t[1],o=t[2],i=t[3],c=t[4],u=t[5],l=t[6],m=t[7],g=t[8],s=t[9],x=t[10],d=t[11],f=t[12],_=t[13],h=t[14];t=t[15];var v=e[0],A=e[1],M=e[2],T=e[3],P=e[4],E=e[5],p=e[6],L=e[7],y=e[8],b=e[9],S=e[10],R=e[11],C=e[12],U=e[13],w=e[14];return e=e[15],r[0]=v*n+A*c+M*g+T*f,r[1]=v*a+A*u+M*s+T*_,r[2]=v*o+A*l+M*x+T*h,r[3]=v*i+A*m+M*d+T*t,r[4]=P*n+E*c+p*g+L*f,r[5]=P*a+E*u+p*s+L*_,r[6]=P*o+E*l+p*x+L*h,r[7]=P*i+E*m+p*d+L*t,r[8]=y*n+b*c+S*g+R*f,r[9]=y*a+b*u+S*s+R*_,r[10]=y*o+b*l+S*x+R*h,r[11]=y*i+b*m+S*d+R*t,r[12]=C*n+U*c+w*g+e*f,r[13]=C*a+U*u+w*s+e*_,r[14]=C*o+U*l+w*x+e*h,r[15]=C*i+U*m+w*d+e*t,r},mat4.translate=function(t,e,r){var n=e[0],a=e[1];if(e=e[2],!r||t==r)return t[12]=t[0]*n+t[4]*a+t[8]*e+t[12],t[13]=t[1]*n+t[5]*a+t[9]*e+t[13],t[14]=t[2]*n+t[6]*a+t[10]*e+t[14],t[15]=t[3]*n+t[7]*a+t[11]*e+t[15],t;var o=t[0],i=t[1],c=t[2],u=t[3],l=t[4],m=t[5],g=t[6],s=t[7],x=t[8],d=t[9],f=t[10],_=t[11];return r[0]=o,r[1]=i,r[2]=c,r[3]=u,r[4]=l,r[5]=m,r[6]=g,r[7]=s,r[8]=x,r[9]=d,r[10]=f,r[11]=_,r[12]=o*n+l*a+x*e+t[12],r[13]=i*n+m*a+d*e+t[13],r[14]=c*n+g*a+f*e+t[14],r[15]=u*n+s*a+_*e+t[15],r},mat4.scale=function(t,e,r){var n=e[0],a=e[1];return e=e[2],r&&t!=r?(r[0]=t[0]*n,r[1]=t[1]*n,r[2]=t[2]*n,r[3]=t[3]*n,r[4]=t[4]*a,r[5]=t[5]*a,r[6]=t[6]*a,r[7]=t[7]*a,r[8]=t[8]*e,r[9]=t[9]*e,r[10]=t[10]*e,r[11]=t[11]*e,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r):(t[0]*=n,t[1]*=n,t[2]*=n,t[3]*=n,t[4]*=a,t[5]*=a,t[6]*=a,t[7]*=a,t[8]*=e,t[9]*=e,t[10]*=e,t[11]*=e,t)},mat4.rotate=function(t,e,r,n){var a=r[0],o=r[1];r=r[2];var i=Math.sqrt(a*a+o*o+r*r);if(!i)return null;1!=i&&(a*=i=1/i,o*=i,r*=i);var c=Math.sin(e),u=Math.cos(e),l=1-u;e=t[0],i=t[1];var m=t[2],g=t[3],s=t[4],x=t[5],d=t[6],f=t[7],_=t[8],h=t[9],v=t[10],A=t[11],M=a*a*l+u,T=o*a*l+r*c,P=r*a*l-o*c,E=a*o*l-r*c,p=o*o*l+u,L=r*o*l+a*c,y=a*r*l+o*c;return a=o*r*l-a*c,o=r*r*l+u,n?t!=n&&(n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]):n=t,n[0]=e*M+s*T+_*P,n[1]=i*M+x*T+h*P,n[2]=m*M+d*T+v*P,n[3]=g*M+f*T+A*P,n[4]=e*E+s*p+_*L,n[5]=i*E+x*p+h*L,n[6]=m*E+d*p+v*L,n[7]=g*E+f*p+A*L,n[8]=e*y+s*a+_*o,n[9]=i*y+x*a+h*o,n[10]=m*y+d*a+v*o,n[11]=g*y+f*a+A*o,n},mat4.frustum=function(t,e,r,n,a,o,i){i||(i=mat4.create());var c=e-t,u=n-r,l=o-a;return i[0]=2*a/c,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*a/u,i[6]=0,i[7]=0,i[8]=(e+t)/c,i[9]=(n+r)/u,i[10]=-(o+a)/l,i[11]=-1,i[12]=0,i[13]=0,i[14]=-o*a*2/l,i[15]=0,i},mat4.perspective=function(t,e,r,n,a){return t=r*Math.tan(t*Math.PI/360),e*=t,mat4.frustum(-e,e,-t,t,r,n,a)};var MATH_PI=Math.PI,MATH_ROUND=Math.round,MATH_RANDOM=Math.random,mvMatrix=mat4.create(),pMatrix=mat4.create(),mvMatrixStack=[],world={blocks:{}},PLAYER_SPEED=40,player={},THEME_MUSIC=[[61.74,.13,.15],[61.74,.13,.3],[61.74,.13,.3],[61.74,.13,.15],[61.74,.13,.15],[61.74,.13,.15],[61.74,.13,.3],[61.74,.13,.3],[61.74,.13,.6],[61.74,.13,.15],[61.74,.13,.3],[61.74,.13,.3],[61.74,.13,.15],[61.74,.13,.15],[61.74,.13,.15],[61.74,.13,.3],[61.74,.13,.3],[61.74,.13,.6],[51.91,.13,.15],[51.91,.13,.3],[51.91,.13,.3],[51.91,.13,.15],[51.91,.13,.15],[51.91,.13,.15],[51.91,.13,.3],[51.91,.13,.3],[51.91,.13,.6],[51.91,.13,.15],[51.91,.13,.3],[51.91,.13,.3],[51.91,.13,.15],[51.91,.13,.15],[51.91,.13,.15],[51.91,.13,.3],[51.91,.13,.3],[51.91,.13,.6],[41.2,.13,.15],[41.2,.13,.3],[41.2,.13,.3],[41.2,.13,.15],[41.2,.13,.15],[41.2,.13,.15],[41.2,.13,.3],[41.2,.13,.3],[41.2,.13,.6],[41.2,.13,.15],[41.2,.13,.3],[41.2,.13,.3],[41.2,.13,.15],[41.2,.13,.15],[41.2,.13,.15],[41.2,.13,.3],[41.2,.13,.3],[41.2,.13,.6],[61.74,.13,.15],[61.74,.13,.3],[61.74,.13,.3],[61.74,.13,.15],[61.74,.13,.15],[61.74,.13,.15],[61.74,.13,.3],[61.74,.13,.3],[61.74,.13,.6],[61.74,.13,.15],[61.74,.13,.3],[61.74,.13,.3],[61.74,.13,.15],[61.74,.13,.15],[61.74,.13,.15],[61.74,.13,.3],[61.74,.13,.3],[61.74,.13,.6]],audioContext=new AudioContext,gain=audioContext.createGain(),canvas=document.getElementById("scene"),context=canvas.getContext("webgl"),shaderProgram=context.createProgram(),camera={x:0,y:6,z:0,pitch:0,yaw:0},textures={},BLOCK_SIZE=100,buffers={cube:{position:gl_createArrayBuffer([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),normal:gl_createArrayBuffer([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),texture:gl_createArrayBuffer([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),index:gl_createElementArrayBuffer([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23])},plane:{position:gl_createArrayBuffer([-50,0,-50,-50,0,50,50,0,50,50,0,-50]),normal:gl_createArrayBuffer([0,1,0,0,1,0,0,1,0,0,1,0]),texture:gl_createArrayBuffer([0,25,0,0,25,0,25,25]),index:gl_createElementArrayBuffer([0,1,2,0,2,3])}},elapsedTime=0,lastTime=0;c_init();</script>
  <div id="a"></div>
  <div id="b"></div>
</body>
</html>