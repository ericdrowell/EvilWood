<!DOCTYPE HTML>
<html>
  <head>
    <title>Evil Wood</title>
    <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
  </head>
  <body>
    <canvas id="sceneCanvas"></canvas>

    <script id="shader-fs" type="x-shader/x-fragment">
        precision mediump float;

        varying vec2 vTextureCoord;
        varying vec3 vLightWeighting;

        uniform sampler2D uSampler;

        void main(void) {
            vec4 textureColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));
            gl_FragColor = vec4(textureColor.rgb * vLightWeighting, textureColor.a);
        }
    </script>

    <script id="shader-vs" type="x-shader/x-vertex">
        attribute vec3 aVertexPosition;
        attribute vec3 aVertexNormal;
        attribute vec2 aTextureCoord;

        uniform mat4 uMVMatrix;
        uniform mat4 uPMatrix;
        uniform mat3 uNMatrix;

        uniform vec3 uAmbientColor;

        uniform vec3 uLightingDirection;
        uniform vec3 uDirectionalColor;

        uniform bool uUseLighting;

        varying vec2 vTextureCoord;
        varying vec3 vLightWeighting;

        void main(void) {
            gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
            vTextureCoord = aTextureCoord;

            if (!uUseLighting) {
                vLightWeighting = vec3(1.0, 1.0, 1.0);
            } else {
                vec3 transformedNormal = uNMatrix * aVertexNormal;
                float directionalLightWeighting = max(dot(transformedNormal, uLightingDirection), 0.0);
                vLightWeighting = uAmbientColor + uDirectionalColor * directionalLightWeighting;
            }
        }
    </script>

    <script>
      var GROUND_TEXTURE_ENCODING = 'data:image/gif;base64,R0lGODlhEAAQAPcAAAAAAP///09gF0tXFVNgGUFKF1FcFkBID1hiFUhRE0ZOC0xUD01VEkdNE19oGk9WF1VdDkFGCzc7CjtAC1RbEGFpEzM3ClRaEzg8DU5TFVFWF1NZHEFFFmpwJD9DCjs+C1NYEVNXEk1SEj9CD0pOFnl+JVldHE9TG1daEVteE05REUlMEERHD1xfFUdJE2ltHVRWF0lLFVlcGl9iHFNVG2BjIFZYHVFTH0BBCT0+CT0+DVJUEkhJEFxdFUlKEUxNE11eGFtcGWprHy8wEDQ1ElpbIF9gJSEhAjAwCTg4C0pKD0VFDlNTEUlJDzs7DVdWFFVVFEREFElJFlVVGl1dHVpaHEtLGC0sBUxKElNRFkA/EUJBElBPFkFAEmRiHD08EVNRGUtJF1pYHEpJGUxLGmBeITY0CTAuCUE+DUpHEUZEE1JPF0hGFkhFFkdFF2RhImViI0VDGEZEGlNRIiEfAzMwCExHEDUyCz47Djs4DjIvDFNOFTw5D0xIFURAFE9LGExIF01JGEdDFmRfIFpVHVhTHTUxBzUxCkA7DUI9D0dCEUZBEkE8EUpFFEdCFElEFUE9E1BLGEM+FFNOHDw4Fz44DTs2DjItDElCE0E7E1lRHE9IGUU/F0I9Fjs2FFRNHVJMHU9JHEZBGldRIiUgATkyC0pCDzcxCy4pCiUhCC8qCzEsDFJJGFtSHVdOHE1GHElCG15WI1VNICwmCUM7EVlPGjQuEUtDGTkzEzEsEVNKIGJYJllQIzIqCkE4EUA4FEY9GE1EHEpBGzs0FlVLIFNJIVFIIicgBzMrDDsyEUtAF0tBHVZNKjYtED81E1RHHkc8GkU7G0k/HyAZBiUeCUw+FzMqEE1AGUQ5GkI4HDsyGUk7FjgtEkQ3GEQ5HDwwFCYeDS4lEE9AHUw+HUk9I2BSMjwuEzwvFkk6G08/H0s8IldGK1tILDouHVRCKUo4IVE/LDYoG0ExJQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAEAAQAAAI/wBvZIDxI5WFBhgc1GBgwogBAQTwOIlz7pAHJEmW8CBDwgWHARvYaJjhZZA4c6UwRaqyIoeWObFGoRBSwRGrWug0AXkCZQcIWLw2MXkh40sQU48mZdkTJhQVN8DAiCEErcuCP+s4pXnGbhcVLsxoFCLWRpQOG+UYfXgFb5ydFG+KCZIkDFs4da6q+Ukgy1kzR33MXEF16lg7d+mUoYkAiBY1PXzItUr0LV60MNI8SUiCK9MvLIvkZSvV7d01HKC8WTuzxVgwNchyrZrVy5AiX6Rscet0okifQ9OG3VJy51KlZOC0hZgyqkUQRFfgfFLRRNWjNcu29RBRpkSQBxCiHCQYAinGmEZ1jljygaCDLkp5iBQYYUUOHVWqJrBQQOFCICkjBAQAOw==';
    </script>

    <script>function getShader(r,e){var t=document.getElementById(e);if(!t)return null;for(var a="",i=t.firstChild;i;)3==i.nodeType&&(a+=i.textContent),i=i.nextSibling;var o;if("x-shader/x-fragment"==t.type)o=r.createShader(r.FRAGMENT_SHADER);else{if("x-shader/x-vertex"!=t.type)return null;o=r.createShader(r.VERTEX_SHADER)}return r.shaderSource(o,a),r.compileShader(o),r.getShaderParameter(o,r.COMPILE_STATUS)?o:(alert(r.getShaderInfoLog(o)),null)}function initShaders(){var r=getShader(gl,"shader-fs"),e=getShader(gl,"shader-vs");shaderProgram=gl.createProgram(),gl.attachShader(shaderProgram,e),gl.attachShader(shaderProgram,r),gl.linkProgram(shaderProgram),gl.getProgramParameter(shaderProgram,gl.LINK_STATUS)||alert("Could not initialise shaders"),gl.useProgram(shaderProgram),shaderProgram.vertexPositionAttribute=gl.getAttribLocation(shaderProgram,"aVertexPosition"),gl.enableVertexAttribArray(shaderProgram.vertexPositionAttribute),shaderProgram.vertexNormalAttribute=gl.getAttribLocation(shaderProgram,"aVertexNormal"),gl.enableVertexAttribArray(shaderProgram.vertexNormalAttribute),shaderProgram.textureCoordAttribute=gl.getAttribLocation(shaderProgram,"aTextureCoord"),gl.enableVertexAttribArray(shaderProgram.textureCoordAttribute),shaderProgram.pMatrixUniform=gl.getUniformLocation(shaderProgram,"uPMatrix"),shaderProgram.mvMatrixUniform=gl.getUniformLocation(shaderProgram,"uMVMatrix"),shaderProgram.nMatrixUniform=gl.getUniformLocation(shaderProgram,"uNMatrix"),shaderProgram.samplerUniform=gl.getUniformLocation(shaderProgram,"uSampler"),shaderProgram.useLightingUniform=gl.getUniformLocation(shaderProgram,"uUseLighting"),shaderProgram.ambientColorUniform=gl.getUniformLocation(shaderProgram,"uAmbientColor"),shaderProgram.lightingDirectionUniform=gl.getUniformLocation(shaderProgram,"uLightingDirection"),shaderProgram.directionalColorUniform=gl.getUniformLocation(shaderProgram,"uDirectionalColor")}function initBuffers(){cubeVertexPositionBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,cubeVertexPositionBuffer),vertices=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(vertices),gl.STATIC_DRAW),cubeVertexPositionBuffer.itemSize=3,cubeVertexPositionBuffer.numItems=24,cubeVertexNormalBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,cubeVertexNormalBuffer);var r=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0];gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(r),gl.STATIC_DRAW),cubeVertexNormalBuffer.itemSize=3,cubeVertexNormalBuffer.numItems=24,cubeVertexTextureCoordBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,cubeVertexTextureCoordBuffer);var e=[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1];gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(e),gl.STATIC_DRAW),cubeVertexTextureCoordBuffer.itemSize=2,cubeVertexTextureCoordBuffer.numItems=24,cubeVertexIndexBuffer=gl.createBuffer(),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,cubeVertexIndexBuffer);var t=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),gl.STATIC_DRAW),cubeVertexIndexBuffer.itemSize=1,cubeVertexIndexBuffer.numItems=36}function handleLoadedTexture(r){gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!0),gl.bindTexture(gl.TEXTURE_2D,r),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,r.image),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_NEAREST),gl.generateMipmap(gl.TEXTURE_2D),gl.bindTexture(gl.TEXTURE_2D,null)}function initTextures(){crateTexture=gl.createTexture(),crateTexture.image=new Image,crateTexture.image.onload=function(){handleLoadedTexture(crateTexture)},crateTexture.image.src=GROUND_TEXTURE_ENCODING}function setMatrixUniforms(){gl.uniformMatrix4fv(shaderProgram.pMatrixUniform,!1,pMatrix),gl.uniformMatrix4fv(shaderProgram.mvMatrixUniform,!1,mvMatrix);var r=mat3.create();mat4.toInverseMat3(mvMatrix,r),mat3.transpose(r),gl.uniformMatrix3fv(shaderProgram.nMatrixUniform,!1,r)}function degToRad(r){return r*Math.PI/180}function drawScene(){gl.viewport(0,0,gl.viewportWidth,gl.viewportHeight),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),mat4.perspective(45,gl.viewportWidth/gl.viewportHeight,.1,100,pMatrix),mat4.identity(mvMatrix),mat4.translate(mvMatrix,[0,0,-5]);mat4.rotate(mvMatrix,degToRad(0),[1,0,0]),mat4.rotate(mvMatrix,degToRad(0),[0,1,0]),gl.bindBuffer(gl.ARRAY_BUFFER,cubeVertexPositionBuffer),gl.vertexAttribPointer(shaderProgram.vertexPositionAttribute,cubeVertexPositionBuffer.itemSize,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,cubeVertexNormalBuffer),gl.vertexAttribPointer(shaderProgram.vertexNormalAttribute,cubeVertexNormalBuffer.itemSize,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,cubeVertexTextureCoordBuffer),gl.vertexAttribPointer(shaderProgram.textureCoordAttribute,cubeVertexTextureCoordBuffer.itemSize,gl.FLOAT,!1,0,0),gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,crateTexture),gl.uniform1i(shaderProgram.samplerUniform,0);gl.uniform1i(shaderProgram.useLightingUniform,!0),gl.uniform3f(shaderProgram.ambientColorUniform,AMBIENT_LIGHT_COLOR,AMBIENT_LIGHT_COLOR,AMBIENT_LIGHT_COLOR);var r=[DIRECTIONAL_LIGHT_X,DIRECTIONAL_LIGHT_Y,DIRECTIONAL_LIGHT_Z],e=vec3.create();vec3.normalize(r,e),vec3.scale(e,-1),gl.uniform3fv(shaderProgram.lightingDirectionUniform,e),gl.uniform3f(shaderProgram.directionalColorUniform,DIRECTIONAL_LIGHT_COLOR,DIRECTIONAL_LIGHT_COLOR,DIRECTIONAL_LIGHT_COLOR),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,cubeVertexIndexBuffer),setMatrixUniforms(),gl.drawElements(gl.TRIANGLES,cubeVertexIndexBuffer.numItems,gl.UNSIGNED_SHORT,0)}function update(){var r=(new Date).getTime();lastTime=r,drawScene(),requestAnimationFrame(update)}function init(){var r=document.getElementById("sceneCanvas");r.width=window.innerWidth,r.height=window.innerHeight,document.body.appendChild(r),gl=r.getContext("webgl"),gl.viewportWidth=r.width,gl.viewportHeight=r.height,initShaders(),initBuffers(),initTextures(),gl.clearColor(0,0,0,1),gl.enable(gl.DEPTH_TEST),update()}glMatrixArrayType="undefined"!=typeof Float32Array?Float32Array:"undefined"!=typeof WebGLFloatArray?WebGLFloatArray:Array;var vec3={};vec3.create=function(r){var e=new glMatrixArrayType(3);return r&&(e[0]=r[0],e[1]=r[1],e[2]=r[2]),e},vec3.scale=function(r,e,t){return t&&r!=t?(t[0]=r[0]*e,t[1]=r[1]*e,t[2]=r[2]*e,t):(r[0]*=e,r[1]*=e,r[2]*=e,r)},vec3.normalize=function(r,e){e||(e=r);var t=r[0],a=r[1],i=r[2],o=Math.sqrt(t*t+a*a+i*i);return o?1==o?(e[0]=t,e[1]=a,e[2]=i,e):(o=1/o,e[0]=t*o,e[1]=a*o,e[2]=i*o,e):(e[0]=0,e[1]=0,e[2]=0,e)};var mat3={};mat3.create=function(r){var e=new glMatrixArrayType(9);return r&&(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9]),e},mat3.transpose=function(r,e){if(!e||r==e){var t=r[1],a=r[2],i=r[5];return r[1]=r[3],r[2]=r[6],r[3]=t,r[5]=r[7],r[6]=a,r[7]=i,r}return e[0]=r[0],e[1]=r[3],e[2]=r[6],e[3]=r[1],e[4]=r[4],e[5]=r[7],e[6]=r[2],e[7]=r[5],e[8]=r[8],e};var mat4={};mat4.create=function(r){var e=new glMatrixArrayType(16);return r&&(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e},mat4.identity=function(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},mat4.toInverseMat3=function(r,e){var t=r[0],a=r[1],i=r[2],o=r[4],n=r[5],g=r[6],u=r[8],l=r[9],m=r[10],f=m*n-g*l,d=-m*o+g*u,c=l*o-n*u,T=t*f+a*d+i*c;return T?(T=1/T,e||(e=mat3.create()),e[0]=f*T,e[1]=(-m*a+i*l)*T,e[2]=(g*a-i*n)*T,e[3]=d*T,e[4]=(m*t-i*u)*T,e[5]=(-g*t+i*o)*T,e[6]=c*T,e[7]=(-l*t+a*u)*T,e[8]=(n*t-a*o)*T,e):null},mat4.multiply=function(r,e,t){t||(t=r);var a=r[0],i=r[1],o=r[2],n=r[3],g=r[4],u=r[5],l=r[6],m=r[7],f=r[8],d=r[9],c=r[10],T=r[11],x=r[12],s=r[13],A=r[14];r=r[15];var h=e[0],R=e[1],E=e[2],I=e[3],v=e[4],_=e[5],P=e[6],b=e[7],B=e[8],L=e[9],U=e[10],M=e[11],C=e[12],N=e[13],F=e[14];return e=e[15],t[0]=h*a+R*g+E*f+I*x,t[1]=h*i+R*u+E*d+I*s,t[2]=h*o+R*l+E*c+I*A,t[3]=h*n+R*m+E*T+I*r,t[4]=v*a+_*g+P*f+b*x,t[5]=v*i+_*u+P*d+b*s,t[6]=v*o+_*l+P*c+b*A,t[7]=v*n+_*m+P*T+b*r,t[8]=B*a+L*g+U*f+M*x,t[9]=B*i+L*u+U*d+M*s,t[10]=B*o+L*l+U*c+M*A,t[11]=B*n+L*m+U*T+M*r,t[12]=C*a+N*g+F*f+e*x,t[13]=C*i+N*u+F*d+e*s,t[14]=C*o+N*l+F*c+e*A,t[15]=C*n+N*m+F*T+e*r,t},mat4.translate=function(r,e,t){var a=e[0],i=e[1];if(e=e[2],!t||r==t)return r[12]=r[0]*a+r[4]*i+r[8]*e+r[12],r[13]=r[1]*a+r[5]*i+r[9]*e+r[13],r[14]=r[2]*a+r[6]*i+r[10]*e+r[14],r[15]=r[3]*a+r[7]*i+r[11]*e+r[15],r;var o=r[0],n=r[1],g=r[2],u=r[3],l=r[4],m=r[5],f=r[6],d=r[7],c=r[8],T=r[9],x=r[10],s=r[11];return t[0]=o,t[1]=n,t[2]=g,t[3]=u,t[4]=l,t[5]=m,t[6]=f,t[7]=d,t[8]=c,t[9]=T,t[10]=x,t[11]=s,t[12]=o*a+l*i+c*e+r[12],t[13]=n*a+m*i+T*e+r[13],t[14]=g*a+f*i+x*e+r[14],t[15]=u*a+d*i+s*e+r[15],t},mat4.scale=function(r,e,t){var a=e[0],i=e[1];return e=e[2],t&&r!=t?(t[0]=r[0]*a,t[1]=r[1]*a,t[2]=r[2]*a,t[3]=r[3]*a,t[4]=r[4]*i,t[5]=r[5]*i,t[6]=r[6]*i,t[7]=r[7]*i,t[8]=r[8]*e,t[9]=r[9]*e,t[10]=r[10]*e,t[11]=r[11]*e,t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t):(r[0]*=a,r[1]*=a,r[2]*=a,r[3]*=a,r[4]*=i,r[5]*=i,r[6]*=i,r[7]*=i,r[8]*=e,r[9]*=e,r[10]*=e,r[11]*=e,r)},mat4.rotate=function(r,e,t,a){var i=t[0],o=t[1];t=t[2];var n=Math.sqrt(i*i+o*o+t*t);if(!n)return null;1!=n&&(n=1/n,i*=n,o*=n,t*=n);var g=Math.sin(e),u=Math.cos(e),l=1-u;e=r[0],n=r[1];var m=r[2],f=r[3],d=r[4],c=r[5],T=r[6],x=r[7],s=r[8],A=r[9],h=r[10],R=r[11],E=i*i*l+u,I=o*i*l+t*g,v=t*i*l-o*g,_=i*o*l-t*g,P=o*o*l+u,b=t*o*l+i*g,B=i*t*l+o*g;return i=o*t*l-i*g,o=t*t*l+u,a?r!=a&&(a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]):a=r,a[0]=e*E+d*I+s*v,a[1]=n*E+c*I+A*v,a[2]=m*E+T*I+h*v,a[3]=f*E+x*I+R*v,a[4]=e*_+d*P+s*b,a[5]=n*_+c*P+A*b,a[6]=m*_+T*P+h*b,a[7]=f*_+x*P+R*b,a[8]=e*B+d*i+s*o,a[9]=n*B+c*i+A*o,a[10]=m*B+T*i+h*o,a[11]=f*B+x*i+R*o,a},mat4.frustum=function(r,e,t,a,i,o,n){n||(n=mat4.create());var g=e-r,u=a-t,l=o-i;return n[0]=2*i/g,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=2*i/u,n[6]=0,n[7]=0,n[8]=(e+r)/g,n[9]=(a+t)/u,n[10]=-(o+i)/l,n[11]=-1,n[12]=0,n[13]=0,n[14]=-o*i*2/l,n[15]=0,n},mat4.perspective=function(r,e,t,a,i){return r=t*Math.tan(r*Math.PI/360),e*=r,mat4.frustum(-e,e,-r,r,t,a,i)};var shaderProgram,cubeVertexPositionBuffer,cubeVertexNormalBuffer,cubeVertexTextureCoordBuffer,cubeVertexIndexBuffer,crateTexture,DIRECTIONAL_LIGHT_X=-.25,DIRECTIONAL_LIGHT_Y=-.25,DIRECTIONAL_LIGHT_Z=-1,DIRECTIONAL_LIGHT_COLOR=.8,AMBIENT_LIGHT_COLOR=.2,gl,lastTime=0,mvMatrix=mat4.create(),pMatrix=mat4.create();init();</script>
  </body>
</html>
