<!DOCTYPE HTML>
<html>
<head>
  <title>Evil Wood</title>
  <style>body,html{padding:0;margin:0;overflow:hidden}canvas{background-color:#000}#a{width:100%;position:fixed;top:10%;left:0;text-align:center;color:#fff;font-family:Courier New,monospace;font-size:4vh}#b{position:fixed;color:red;font-size:5vh;top:10px;left:10px;font-family:Courier New,monospace}#b span{margin-right:5px}</style>
</head>
<body>
  <canvas id="scene"></canvas></div><div id="a"></div><div id="b"></div>
  <script>!function(){function t(){this.setSettings=function(t){for(var n=0;n<24;n++)this[String.fromCharCode(97+n)]=t[n]||0;this.c<.01&&(this.c=.01);var e=this.b+this.c+this.e;if(e<.18){var r=.18/e;this.b*=r,this.c*=r,this.e*=r}}}function n(t){return 1/t==-1/0?-1*t:t}function e(t){return t[Math.floor(rn()*t.length)]}function r(){bn.enable(bn.DEPTH_TEST)}function i(){bn.viewport(0,0,dn.width,dn.height),bn.clear(bn.COLOR_BUFFER_BIT|bn.DEPTH_BUFFER_BIT)}function o(){var t=St.create();St.set(on,t),cn.push(t)}function a(){if(0==cn.length)throw"Invalid popMatrix!";on=cn.pop()}function c(){v(),g(),d(),b()}function u(t,n){var e=bn.createShader(bn.FRAGMENT_SHADER);bn.shaderSource(e,t),bn.compileShader(e);var r=bn.createShader(bn.VERTEX_SHADER);bn.shaderSource(r,n),bn.compileShader(r),bn.attachShader(pn,r),bn.attachShader(pn,e),bn.linkProgram(pn),bn.getProgramParameter(pn,bn.LINK_STATUS)||alert("Could not initialize shaders"),bn.useProgram(pn),c()}function s(t,n,e){St.perspective(t,dn.width/dn.height,n,e,an)}function f(){St.identity(on)}function h(t,n,e){St.translate(on,[t,n,e])}function l(t,n,e,r){St.rotate(on,t,[n,e,r])}function m(t,n,e){St.scale(on,[t,n,e])}function v(){pn.vertexPositionAttribute=bn.getAttribLocation(pn,"aVertexPosition"),bn.enableVertexAttribArray(pn.vertexPositionAttribute),pn.pMatrixUniform=bn.getUniformLocation(pn,"uPMatrix"),pn.mvMatrixUniform=bn.getUniformLocation(pn,"uMVMatrix")}function g(){pn.textureCoordAttribute=bn.getAttribLocation(pn,"aTextureCoord"),bn.enableVertexAttribArray(pn.textureCoordAttribute),pn.samplerUniform=bn.getUniformLocation(pn,"uSampler")}function d(){pn.vertexNormalAttribute=bn.getAttribLocation(pn,"aVertexNormal"),bn.enableVertexAttribArray(pn.vertexNormalAttribute),pn.nMatrixUniform=bn.getUniformLocation(pn,"uNMatrix")}function b(){pn.useLightingUniform=bn.getUniformLocation(pn,"uUseLighting"),pn.ambientColorUniform=bn.getUniformLocation(pn,"uAmbientColor"),pn.pointLightingLocationUniform=bn.getUniformLocation(pn,"uPointLightingLocation"),pn.pointLightingColorUniform=bn.getUniformLocation(pn,"uPointLightingColor"),pn.useDistanceLighWeightingUniform=bn.getUniformLocation(pn,"uUseDistanceLightWeighting")}function p(t,n){bn.pixelStorei(bn.UNPACK_FLIP_Y_WEBGL,!0),bn.bindTexture(bn.TEXTURE_2D,t),bn.texImage2D(bn.TEXTURE_2D,0,bn.RGBA,bn.RGBA,bn.UNSIGNED_BYTE,n),bn.texParameteri(bn.TEXTURE_2D,bn.TEXTURE_MAG_FILTER,bn.NEAREST),bn.texParameteri(bn.TEXTURE_2D,bn.TEXTURE_MIN_FILTER,bn.LINEAR_MIPMAP_NEAREST),bn.generateMipmap(bn.TEXTURE_2D),bn.bindTexture(bn.TEXTURE_2D,null)}function x(t){var n=bn.createBuffer();return n.numElements=t.length,bn.bindBuffer(bn.ARRAY_BUFFER,n),bn.bufferData(bn.ARRAY_BUFFER,new Float32Array(t),bn.STATIC_DRAW),n}function y(t){var n=bn.createBuffer();return n.numElements=t.length,bn.bindBuffer(bn.ELEMENT_ARRAY_BUFFER,n),bn.bufferData(bn.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),bn.STATIC_DRAW),n}function E(t,n,e){bn.bindBuffer(bn.ARRAY_BUFFER,t.position),bn.vertexAttribPointer(pn.vertexPositionAttribute,3,bn.FLOAT,!1,0,0),bn.bindBuffer(bn.ARRAY_BUFFER,t.texture),bn.vertexAttribPointer(pn.textureCoordAttribute,2,bn.FLOAT,!1,0,0),bn.activeTexture(bn.TEXTURE0),bn.bindTexture(bn.TEXTURE_2D,n),bn.uniform1i(pn.samplerUniform,0),bn.uniform1i(pn.useDistanceLighWeightingUniform,e),bn.bindBuffer(bn.ELEMENT_ARRAY_BUFFER,t.index),bn.bindBuffer(bn.ARRAY_BUFFER,t.normal),bn.vertexAttribPointer(pn.vertexNormalAttribute,3,bn.FLOAT,!1,0,0)}function T(){bn.uniformMatrix4fv(pn.pMatrixUniform,!1,an),bn.uniformMatrix4fv(pn.mvMatrixUniform,!1,on);var t=zt.create();St.toInverseMat3(on,t),zt.transpose(t),bn.uniformMatrix3fv(pn.nMatrixUniform,!1,t)}function A(t){T(),bn.drawElements(bn.TRIANGLES,t.index.numElements,bn.UNSIGNED_SHORT,0)}function M(){bn.uniform1i(pn.useLightingUniform,!0)}function L(t,n,e){bn.uniform3f(pn.ambientColorUniform,t,n,e)}function R(t,n,e){bn.uniform3f(pn.pointLightingColorUniform,t,n,e)}function U(){return"\nprecision highp float;\nvarying vec2 vTextureCoord;\nvarying vec3 vLightWeighting;\nuniform sampler2D uSampler;\nvoid main(void) {\nvec4 textureColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\ngl_FragColor = vec4(textureColor.rgb * vLightWeighting, textureColor.a);\n}"}function w(){return"\nattribute vec3 aVertexPosition;\nattribute vec3 aVertexNormal;\nattribute vec2 aTextureCoord;\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nuniform mat3 uNMatrix;\nuniform vec3 uAmbientColor;\nuniform vec3 uPointLightingLocation;\nuniform vec3 uPointLightingColor;\nuniform bool uUseLighting;\nvarying vec2 vTextureCoord;\nvarying vec3 vLightWeighting;\nuniform bool uUseDistanceLightWeighting;\nvoid main(void) {\nfloat distanceLightWeighting = 1.0;\nvec4 mvPosition = uMVMatrix * vec4(aVertexPosition, 1.0);\ngl_Position = uPMatrix * mvPosition;\nvTextureCoord = aTextureCoord;\nvec3 lightDirection = normalize(uPointLightingLocation - mvPosition.xyz);\nvec3 transformedNormal = uNMatrix * aVertexNormal;\nfloat directionalLightWeighting = max(dot(transformedNormal, lightDirection), 0.0);\nfloat mvDistance = length(uPointLightingLocation - mvPosition.xyz);\nif (uUseDistanceLightWeighting) {\ndistanceLightWeighting = pow(0.992, mvDistance*2.0);\n}\nvLightWeighting = uAmbientColor + uPointLightingColor * distanceLightWeighting;\n}"}function C(){sn={blocks:{},beacon:{},monsters:[],lasers:[],grid:{}},fn=0,G(0,0),X(),H()}function z(t){return{x:en(t.x/Ot),y:en(t.y/Ot),z:en(t.z/Ot)}}function S(){var t=sn.beacon,n=jt*nn*2*Rn/1e3;t.rotationY+=n;var e=_t*nn*2*Rn/1e3;t.orbitY+=e,N(t),t.x=Math.cos(t.orbitY)*Pt,t.z=Math.sin(t.orbitY)*Pt,O(sn.beacon,sn.beacon)}function D(){sn.monsters.forEach(function(t,n){if(t.health<=0)t.points.forEach(function(t){N(t)}),sn.monsters.splice(n,1),mn.play("monster-die");else{var e=t.points[0],r=Ct.create([e.x-xn.x,0,e.z-xn.z]);Ct.normalize(r);var i=(0===t.points[0].y?Wt:Vt)*Rn/1e3;rn()<Qt&&0===t.verticalVelocity&&(t.verticalVelocity=rn()*(Zt-$t)+$t);var o=t.verticalVelocity*Rn/1e3;t.verticalVelocity-=tn*(Rn/1e3),t.points.forEach(function(n,e){N(n),n.x+=r[0]*i*-1,n.y+=o,n.z+=r[2]*i*-1,n.y<2*e&&(n.y=2*e,t.verticalVelocity=0),N(n),O(t,n)})}})}function I(){var t=Ft*Rn/1e3*-1;sn.lasers.forEach(function(n,e){var r=n.pitch+nn/2,i=n.yaw;n.x+=Math.sin(i)*Math.sin(r)*t,n.y+=Math.cos(r)*t,n.z+=Math.cos(i)*Math.sin(r)*t;var o=P(n);o&&"monster"===o.type&&(o.timout&&clearTimeout(o.timeout),o.isHit=!0,sn.lasers.splice(e,1),o.timeout=setTimeout(function(){o.isHit=!1,o.health-=1,mn.play("damage")},Xt)),B(n)&&(sn.lasers.splice(e,1),mn.play("damage")),n.y<=0&&(sn.lasers.splice(e,1),mn.play("damage")),n.expire<=wn&&sn.lasers.splice(e,1)})}function N(t){for(var n=z(t),e=-1;e<=1;e++)for(var r=-1;r<=1;r++){var i=_({x:n.x+e,y:n.y,z:n.z+r});sn.grid[i]=null}}function P(t){var n=_(z(t));return sn.grid[n]}function _(t){return t.x+":"+t.y+":"+t.z}function O(t,n){for(var e=z(n),r=-1;r<=1;r++)for(var i=-1;i<=1;i++){var o=_({x:e.x+r,y:e.y,z:e.z+i});sn.grid[o]=t}}function F(t,n){for(var e=z(t),r=[],i=-n;i<=n;i++)for(var o=-n;o<=n;o++)for(var a=-n;a<=n;a++){var c=_({x:e.x+i,y:e.y+o,z:e.z+a});sn.grid[c]&&r.push(sn.grid[c])}return r}function k(t,n){for(var e=z(t),r=[],i=-n;i<=n;i++){var o=_({x:e.x,y:e.y+i,z:e.z});sn.grid[o]&&r.push(sn.grid[o])}return r}function Y(){var t=F({x:xn.x,y:6,z:xn.z},3);for(var n in t)if("beacon"===t[n].type)return!0;return!1}function B(t){var n=k(t,1);for(var e in n)if("tree"===n[e].type)return!0;return!1}function W(){var t=F(xn,5);for(var n in t)if("tree"===t[n].type)return t[n];return null}function V(){var t=F(xn,3),n=[];for(var e in t)"monster"===t[e].type&&n.push(t[e]);return n}function H(){var t=rn()*nn*2;sn.beacon={type:"beacon",x:Math.cos(t)*Pt,y:6,z:Math.sin(t)*Pt,rotationY:0,orbitY:t},O(sn.beacon,sn.beacon)}function G(t,n){void 0===sn.blocks[t]&&(sn.blocks[t]={}),sn.blocks[t][n]={trees:[]};for(var e=0;e<It;e++){for(var r=60+60*rn(),i={type:"tree",points:[],rotationY:rn()*nn*2,height:r},o=t*Mn+rn()*Mn-Mn/2,a=n*Mn+rn()*Mn-Mn/2,c=0;c<r/4;c++){var u={x:o,y:4*c,z:a};i.points.push(u),O(i,u)}sn.blocks[t][n].trees.push(i)}if(fn>=9&&rn()<=Nt){for(var s=t*Mn+rn()*Mn-Mn/2,f=n*Mn+rn()*Mn-Mn/2,h={type:"monster",points:[],health:3,verticalVelocity:0},c=0;c<4;c++){var l={x:s,y:2*c,z:f};h.points.push(l),O(h,l)}sn.monsters.push(h)}fn++}function K(){var t=n(en(xn.x/Mn)),e=n(en(xn.z/Mn));return[{x:t,z:e},{x:t-1,z:e-1},{x:t,z:e-1},{x:t+1,z:e-1},{x:t+1,z:e},{x:t+1,z:e+1},{x:t,z:e+1},{x:t-1,z:e+1},{x:t-1,z:e}]}function X(){K().forEach(function(t){var n=t.x,e=t.z;void 0===sn.blocks[n]&&(sn.blocks[n]={}),void 0===sn.blocks[n][e]&&G(n,e)})}function q(){hn={straightMovement:0,sideMovement:0,isClimbing:!1,health:7}}function j(){var t={x:xn.x,y:xn.y,z:xn.z};if(0!==hn.straightMovement){var n=1===hn.straightMovement?-1:1;hn.isClimbing&&xn.pitch<-0&&(n*=-1);e=n*Ht*Rn/1e3;hn.isClimbing?(xn.y+=-1*e,xn.y<Gt&&(xn.y=Gt,hn.isClimbing=!1),hn.isClimbing&&xn.y>zn.height+10&&(xn.y=zn.height+10)):(xn.z+=e*Math.cos(xn.yaw),xn.x+=e*Math.sin(xn.yaw))}if(0!==hn.sideMovement){var e=(n=1===hn.sideMovement?1:-1)*Ht*Rn/1e3;xn.z+=e*Math.cos(xn.yaw+Math.PI/2),xn.x+=e*Math.sin(xn.yaw+Math.PI/2)}var r=P({x:xn.x,y:0,z:xn.z});r&&"tree"===r.type&&(xn.x=t.x,xn.y=t.y,xn.z=t.z),Y()&&"won"!==Cn&&Lt(),hn.health<=0&&"died"!==Cn&&Rt(),V().forEach(function(t){t.cooldown||(J(),t.cooldown=!0,setTimeout(function(){t.cooldown=!1},1e3*Bt))})}function J(){ln||(mn.play("monster-hit"),setTimeout(function(){dn.style.opacity=1,ln=!1},Xt),dn.style.opacity=.4)}function Q(){var t=xn.pitch+nn/2+nn/2,n=xn.yaw;sn.lasers.push({x:xn.x+Math.sin(n)*Math.sin(t)*Yt+Math.sin(n+nn/4)*Yt,y:xn.y+Math.cos(t)*Yt,z:xn.z+Math.cos(n)*Math.sin(t)*Yt+Math.cos(n+nn/4)*Yt,pitch:xn.pitch,yaw:xn.yaw,expire:1e3*(new Date/1e3+kt)}),mn.play("laser")}function Z(){this.sounds={}}function $(){vn=new AudioContext}function tt(t,n){}function nt(){dn.width=window.innerWidth,dn.height=window.innerHeight,u(U(),w()),ut(function(){wt()})}function et(t){var n=document.createElement("canvas");n.width=16,n.height=16;for(var r=n.getContext("2d"),i=0;i<16;i++)for(var o=0;o<16;o++)r.save(),r.fillStyle="#"+e(t),r.fillRect(i,o,2,2),r.restore();return n.toDataURL()}function rt(){En.innerHTML="EVIL WOOD<br><br>YOU ARE LOST IN AN EVIL FOREST<br>CLIMB TREES TO SEE THE SKY<br>LET THE NORTH STAR GUIDE YOU<br>FIND THE RED FAIRY TO ESCAPE<br>BEWARE THE DARK SOULS<br><br>"+gn+"<br><br>CLICK SCREEN TO START",An=(new Date).getTime()}function it(){En.innerHTML="PAUSED<br><br>"+gn+"<br>CLICK SCREEN TO CONTINUE",An=(new Date).getTime()}function ot(){En.innerHTML="YOU WIN!<br><br>CONGRATULATIONS ON ESCAPING EVIL WOOD<br>YOUR CUNNING, SKILL, AND BRAVERY<br>WILL BE REMEMBERED FOR ALL TIME<br><br>CLICK SCREEN TO PLAY AGAIN",An=(new Date).getTime()}function at(){En.innerHTML="YOU DIED<br><br>DARK SOULS DEVOUR YOUR BODY<br>DARKNESS FALLS AND EVIL WOOD FADES AWAY<br>YOUR HORRIFIC FATE IS LOST FOREVER<br><br>CLICK SCREEN TO TRY AGAIN",An=(new Date).getTime()}function ct(){En.innerHTML=""}function ut(t){yn={tree:{encoding:et(["4a493b","534e3e","3d3527","524534","46433b","443e2b","271c10"])},ground:{encoding:et(["2c2e20","282e26","303e1a","444b31","393c2c","33352f","333435","2c2e23","3d3f36","3d3a30","464339","514938","6a6554"])},leaves:{encoding:et(["51531f","4e5315","545617","4c4d13","252108","33370a","474d13","383c0d"])},red:{encoding:et(["ff0000"])},shadow:{encoding:et(["000000"])},monster:{encoding:et(["5f3b88","56367e","4d3279","553783","412d6f","3b2866","4b337a","563986","4e3179","54367f","663f8f","382460"])},orange:{encoding:et(["ffcc00"])},white:{encoding:et(["ffffff"])}};var n=0,e=0;for(var r in yn)!function(){e++;var i=yn[r],o=i.glTexture=bn.createTexture(),a=i.image=new Image;a.onload=function(){p(o,a),++n>=e&&t()},a.src=i.encoding}()}function st(){var t=sn.beacon;if("won"!==Cn){o(),h(t.x,t.y,t.z),l(t.rotationY,0,1,0),E(Ln.cube,yn.red.glTexture,!1),A(Ln.cube),a(),o(),h(t.x,-1.99,t.z),l(t.rotationY,0,1,0),E(Ln.cube,yn.shadow.glTexture,!0),A(Ln.cube),a();var n=Ct.create([t.x-xn.x,0,t.z-xn.z]);Ct.normalize(n),o(),h(xn.x,140,xn.z),h(n[0]*Kt,0,n[2]*Kt),E(Ln.cube,yn.orange.glTexture,!1),A(Ln.cube),a()}}function ft(){sn.monsters.forEach(function(t){var n=t.isHit?"white":"monster";t.points.forEach(function(t){o(),h(t.x,t.y,t.z),E(Ln.cube,yn[n].glTexture,!0),A(Ln.cube),a()})})}function ht(t,n){o(),h(t*Mn,-1.1,n*Mn),E(Ln.plane,yn.ground.glTexture,!0),A(Ln.plane),a()}function lt(t,n){if(sn.blocks[t]&&sn.blocks[t][n])for(var e=sn.blocks[t][n].trees,r=0;r<e.length;r++){var i=e[r];i.points.forEach(function(t){o(),h(t.x,t.y,t.z),l(i.rotationY,0,1,0),m(2,2,2),E(Ln.cube,yn.tree.glTexture,!0),A(Ln.cube),a()});var c=i.points[i.points.length-1],u=c.x,s=c.y,f=c.z;un.forEach(function(t){o(),h(u+8*t[0],s+8*t[2],f+8*t[1]),m(4,4,4),E(Ln.cube,yn.leaves.glTexture,!0),A(Ln.cube),a()})}}function mt(){for(var t="",n=0;n<hn.health;n++)t+="<span>&hearts;</span>";Tn.innerHTML=t}function vt(){K().forEach(function(t){var n=t.x,e=t.z;ht(n,e),lt(n,e)})}function gt(){sn.lasers.forEach(function(t){o(),h(t.x,t.y,t.z),l(t.yaw,0,1,0),l(t.pitch,1,0,0),m(.2,.2,5),E(Ln.cube,yn.orange.glTexture,!1),A(Ln.cube),a()})}function dt(){i(),s(45,.1,150),f(),M(),L(0,0,0),R(.9,.9,.9),l(-xn.pitch,1,0,0),l(-xn.yaw,0,1,0),h(-xn.x,-xn.y,-xn.z),mt(),vt(),st(),ft(),gt()}function bt(){xn={x:0,y:Gt,z:0,pitch:0,yaw:0},C(),q(),Cn="menu",tt("menu",.1),rt()}function pt(t){switch(t.which||t.keyCode){case 65:"playing"!==Cn||hn.isClimbing||(hn.sideMovement=-1);break;case 87:"playing"===Cn&&(hn.straightMovement=1);break;case 68:"playing"!==Cn||hn.isClimbing||(hn.sideMovement=1);break;case 83:"playing"===Cn&&(hn.straightMovement=-1);break;case 32:"playing"!==Cn||hn.isClimbing||(zn=W())&&(hn.isClimbing=!0,xn.y+=qt)}}function xt(t){switch(t.which||t.keyCode){case 65:hn.sideMovement=0;break;case 87:hn.straightMovement=0;break;case 68:hn.sideMovement=0;break;case 83:hn.straightMovement=0}}function yt(t){Et()&&(xn.pitch+=t.movementY*nn*.001*-1,xn.pitch>nn/2&&(xn.pitch=nn/2),xn.pitch<-1*nn/2&&(xn.pitch=-1*nn/2),xn.yaw+=t.movementX*nn*.001*-1)}function Et(){return document.pointerLockElement===dn}function Tt(t){var n=(new Date).getTime();"playing"===Cn?Q():n>An+1e3*Jt&&("menu"===Cn||"paused"===Cn?At():"playing"===Cn?Q():"won"!==Cn&&"died"!==Cn||bt())}function At(){Cn="playing",dn.requestPointerLock(),ct(),tt("play",.05)}function Mt(){Cn="paused",tt("menu",.1),it()}function Lt(){document.exitPointerLock(),Cn="won",tt("menu",.1),ot()}function Rt(){document.exitPointerLock(),Cn="died",tt("menu",.1),at(),mn.play("powerup")}function Ut(){document.addEventListener("keydown",function(t){pt(t)},!1),document.addEventListener("keyup",function(t){xt(t)},!1),document.addEventListener("mousemove",function(t){yt(t)},!1),document.addEventListener("mousedown",function(t){Tt(t)},!1),document.addEventListener("pointerlockchange",function(t){Et()||"playing"!==Cn||Mt()},!1)}function wt(){wn=(new Date).getTime(),0!==Un&&(Rn=wn-Un),"playing"===Cn&&(j(),I(),D(),S(),X(!0)),dt(),Un=wn,window.requestAnimationFrame(wt)}glMatrixArrayType="undefined"!=typeof Float32Array?Float32Array:"undefined"!=typeof WebGLFloatArray?WebGLFloatArray:Array;var Ct={};Ct.create=function(t){var n=new glMatrixArrayType(3);return t&&(n[0]=t[0],n[1]=t[1],n[2]=t[2]),n},Ct.scale=function(t,n,e){return e&&t!=e?(e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e):(t[0]*=n,t[1]*=n,t[2]*=n,t)},Ct.normalize=function(t,n){n||(n=t);var e=t[0],r=t[1],i=t[2],o=Math.sqrt(e*e+r*r+i*i);return o?1==o?(n[0]=e,n[1]=r,n[2]=i,n):(o=1/o,n[0]=e*o,n[1]=r*o,n[2]=i*o,n):(n[0]=0,n[1]=0,n[2]=0,n)},Ct.direction=function(t,n,e){e||(e=t);var r=t[0]-n[0],i=t[1]-n[1];return t=t[2]-n[2],(n=Math.sqrt(r*r+i*i+t*t))?(n=1/n,e[0]=r*n,e[1]=i*n,e[2]=t*n,e):(e[0]=0,e[1]=0,e[2]=0,e)};var zt={};zt.create=function(t){var n=new glMatrixArrayType(9);return t&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9]),n},zt.transpose=function(t,n){if(!n||t==n){var e=t[1],r=t[2],i=t[5];return t[1]=t[3],t[2]=t[6],t[3]=e,t[5]=t[7],t[6]=r,t[7]=i,t}return n[0]=t[0],n[1]=t[3],n[2]=t[6],n[3]=t[1],n[4]=t[4],n[5]=t[7],n[6]=t[2],n[7]=t[5],n[8]=t[8],n};var St={};St.set=function(t,n){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},St.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},St.create=function(t){var n=new glMatrixArrayType(16);return t&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n},St.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},St.toMat3=function(t,n){return n||(n=zt.create()),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[4],n[4]=t[5],n[5]=t[6],n[6]=t[8],n[7]=t[9],n[8]=t[10],n},St.toInverseMat3=function(t,n){var e=t[0],r=t[1],i=t[2],o=t[4],a=t[5],c=t[6],u=t[8],s=t[9],f=t[10],h=f*a-c*s,l=-f*o+c*u,m=s*o-a*u,v=e*h+r*l+i*m;return v?(v=1/v,n||(n=zt.create()),n[0]=h*v,n[1]=(-f*r+i*s)*v,n[2]=(c*r-i*a)*v,n[3]=l*v,n[4]=(f*e-i*u)*v,n[5]=(-c*e+i*o)*v,n[6]=m*v,n[7]=(-s*e+r*u)*v,n[8]=(a*e-r*o)*v,n):null},St.multiply=function(t,n,e){e||(e=t);var r=t[0],i=t[1],o=t[2],a=t[3],c=t[4],u=t[5],s=t[6],f=t[7],h=t[8],l=t[9],m=t[10],v=t[11],g=t[12],d=t[13],b=t[14];t=t[15];var p=n[0],x=n[1],y=n[2],E=n[3],T=n[4],A=n[5],M=n[6],L=n[7],R=n[8],U=n[9],w=n[10],C=n[11],z=n[12],S=n[13],D=n[14];return n=n[15],e[0]=p*r+x*c+y*h+E*g,e[1]=p*i+x*u+y*l+E*d,e[2]=p*o+x*s+y*m+E*b,e[3]=p*a+x*f+y*v+E*t,e[4]=T*r+A*c+M*h+L*g,e[5]=T*i+A*u+M*l+L*d,e[6]=T*o+A*s+M*m+L*b,e[7]=T*a+A*f+M*v+L*t,e[8]=R*r+U*c+w*h+C*g,e[9]=R*i+U*u+w*l+C*d,e[10]=R*o+U*s+w*m+C*b,e[11]=R*a+U*f+w*v+C*t,e[12]=z*r+S*c+D*h+n*g,e[13]=z*i+S*u+D*l+n*d,e[14]=z*o+S*s+D*m+n*b,e[15]=z*a+S*f+D*v+n*t,e},St.translate=function(t,n,e){var r=n[0],i=n[1];if(n=n[2],!e||t==e)return t[12]=t[0]*r+t[4]*i+t[8]*n+t[12],t[13]=t[1]*r+t[5]*i+t[9]*n+t[13],t[14]=t[2]*r+t[6]*i+t[10]*n+t[14],t[15]=t[3]*r+t[7]*i+t[11]*n+t[15],t;var o=t[0],a=t[1],c=t[2],u=t[3],s=t[4],f=t[5],h=t[6],l=t[7],m=t[8],v=t[9],g=t[10],d=t[11];return e[0]=o,e[1]=a,e[2]=c,e[3]=u,e[4]=s,e[5]=f,e[6]=h,e[7]=l,e[8]=m,e[9]=v,e[10]=g,e[11]=d,e[12]=o*r+s*i+m*n+t[12],e[13]=a*r+f*i+v*n+t[13],e[14]=c*r+h*i+g*n+t[14],e[15]=u*r+l*i+d*n+t[15],e},St.scale=function(t,n,e){var r=n[0],i=n[1];return n=n[2],e&&t!=e?(e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e):(t[0]*=r,t[1]*=r,t[2]*=r,t[3]*=r,t[4]*=i,t[5]*=i,t[6]*=i,t[7]*=i,t[8]*=n,t[9]*=n,t[10]*=n,t[11]*=n,t)},St.rotate=function(t,n,e,r){var i=e[0],o=e[1];e=e[2];var a=Math.sqrt(i*i+o*o+e*e);if(!a)return null;1!=a&&(i*=a=1/a,o*=a,e*=a);var c=Math.sin(n),u=Math.cos(n),s=1-u;n=t[0],a=t[1];var f=t[2],h=t[3],l=t[4],m=t[5],v=t[6],g=t[7],d=t[8],b=t[9],p=t[10],x=t[11],y=i*i*s+u,E=o*i*s+e*c,T=e*i*s-o*c,A=i*o*s-e*c,M=o*o*s+u,L=e*o*s+i*c,R=i*e*s+o*c;return i=o*e*s-i*c,o=e*e*s+u,r?t!=r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]):r=t,r[0]=n*y+l*E+d*T,r[1]=a*y+m*E+b*T,r[2]=f*y+v*E+p*T,r[3]=h*y+g*E+x*T,r[4]=n*A+l*M+d*L,r[5]=a*A+m*M+b*L,r[6]=f*A+v*M+p*L,r[7]=h*A+g*M+x*L,r[8]=n*R+l*i+d*o,r[9]=a*R+m*i+b*o,r[10]=f*R+v*i+p*o,r[11]=h*R+g*i+x*o,r},St.frustum=function(t,n,e,r,i,o,a){a||(a=St.create());var c=n-t,u=r-e,s=o-i;return a[0]=2*i/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*i/u,a[6]=0,a[7]=0,a[8]=(n+t)/c,a[9]=(r+e)/u,a[10]=-(o+i)/s,a[11]=-1,a[12]=0,a[13]=0,a[14]=-o*i*2/s,a[15]=0,a},St.perspective=function(t,n,e,r,i){return t=e*Math.tan(t*Math.PI/360),n*=t,St.frustum(-n,n,-t,t,e,r,i)};var Dt=new function(){this._params=new t;var n,e,r,i,o,a,c,u,s,f,h,l;this.reset=function(){var t=this._params;i=100/(t.f*t.f+.001),o=100/(t.g*t.g+.001),a=1-t.h*t.h*t.h*.01,c=-t.i*t.i*t.i*1e-6,t.a||(h=.5-t.n/2,l=5e-5*-t.o),u=1+t.l*t.l*(t.l>0?-.9:10),s=0,f=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},this.totalReset=function(){this.reset();var t=this._params;return n=t.b*t.b*1e5,e=t.c*t.c*1e5,r=t.e*t.e*1e5+12,3*((n+e+r)/3|0)},this.synthWave=function(t,m){var v=this._params,g=1!=v.s||v.v,d=v.v*v.v*.1,b=1+3e-4*v.w,p=v.s*v.s*v.s*.1,x=1+1e-4*v.t,y=1!=v.s,E=v.x*v.x,T=v.g,A=v.q||v.r,M=v.r*v.r*v.r*.2,L=v.q*v.q*(v.q<0?-1020:1020),R=v.p?32+((1-v.p)*(1-v.p)*2e4|0):0,U=v.d,w=v.j/2,C=v.k*v.k*.01,z=v.a,S=n,D=1/n,I=1/e,N=1/r,P=5/(1+v.u*v.u*20)*(.01+p);P>.8&&(P=.8),P=1-P;for(var _,O,F,k,Y,B,W=!1,V=0,H=0,G=0,K=0,X=0,q=0,j=0,J=0,Q=0,Z=0,$=new Array(1024),tt=new Array(32),nt=$.length;nt--;)$[nt]=0;for(nt=tt.length;nt--;)tt[nt]=2*Math.random()-1;for(nt=0;nt<m;nt++){if(W)return nt;if(R&&++Q>=R&&(Q=0,this.reset()),f&&++s>=f&&(f=0,i*=u),a+=c,(i*=a)>o&&(i=o,T>0&&(W=!0)),O=i,w>0&&(Z+=C,O*=1+Math.sin(Z)*w),(O|=0)<8&&(O=8),z||((h+=l)<0?h=0:h>.5&&(h=.5)),++H>S)switch(H=0,++V){case 1:S=e;break;case 2:S=r}switch(V){case 0:G=H*D;break;case 1:G=1+2*(1-H*I)*U;break;case 2:G=1-H*N;break;case 3:G=0,W=!0}A&&((F=0|(L+=M))<0?F=-F:F>1023&&(F=1023)),g&&b&&((d*=b)<1e-5?d=1e-5:d>.1&&(d=.1)),B=0;for(var et=8;et--;){if(++j>=O&&(j%=O,3==z))for(var rt=tt.length;rt--;)tt[rt]=2*Math.random()-1;switch(z){case 0:Y=j/O<h?.5:-.5;break;case 1:Y=1-j/O*2;break;case 2:Y=.225*(((Y=1.27323954*(k=6.28318531*((k=j/O)>.5?k-1:k))+.405284735*k*k*(k<0?1:-1))<0?-1:1)*Y*Y-Y)+Y;break;case 3:Y=tt[Math.abs(32*j/O|0)]}g&&(_=q,(p*=x)<0?p=0:p>.1&&(p=.1),y?(X+=(Y-q)*p,X*=P):(q=Y,X=0),K+=(q+=X)-_,Y=K*=1-d),A&&($[J%1024]=Y,Y+=$[(J-F+1024)%1024],J++),B+=Y}B*=.125*G*E,t[nt]=B>=1?32767:B<=-1?-32768:32767*B|0}return m}};window.jsfxr=function(t){Dt._params.setSettings(t);var n=Dt.totalReset(),e=new Uint8Array(4*((n+1)/2|0)+44),r=2*Dt.synthWave(new Uint16Array(e.buffer,44),n),i=new Uint32Array(e.buffer,0,44);i[0]=1179011410,i[1]=r+36,i[2]=1163280727,i[3]=544501094,i[4]=16,i[5]=65537,i[6]=44100,i[7]=88200,i[8]=1048578,i[9]=1635017060,i[10]=r,r+=44;for(var o=0,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c="data:audio/wav;base64,";o<r;o+=3){var u=e[o]<<16|e[o+1]<<8|e[o+2];c+=a[u>>18]+a[u>>12&63]+a[u>>6&63]+a[63&u]}return c};var It=10,Nt=.5,Pt=50,_t=.03,Ot=2,Ft=350,kt=1,Yt=2,Bt=1,Wt=10,Vt=25,Ht=40,Gt=6,Kt=100,Xt=100,qt=11,jt=.5,Jt=.5,Qt=.015,Zt=100,$t=50,tn=100,nn=Math.PI,en=Math.round,rn=Math.random,on=St.create(),an=St.create(),cn=[],un=[[-1,-2,-2],[0,-2,-2],[1,-2,-2],[-2,-1,-2],[-1,-1,-1],[0,-1,-1],[1,-1,-1],[2,-1,-2],[-2,0,-2],[-1,0,-1],[1,0,-1],[2,0,-2],[-2,1,-2],[-1,1,-1],[0,1,-1],[1,1,-1],[2,1,-2],[-1,2,-2],[0,2,-2],[1,2,-2],[0,0,0]],sn={},fn=0,hn={},ln=!1;Z.prototype.add=function(t,n,e){this.sounds[t]=[],e.forEach(function(e,r){this.sounds[t].push({tick:0,count:n,pool:[]});for(var i=0;i<n;i++){var o=new Audio;o.src=jsfxr(e),this.sounds[t][r].pool.push(o)}},this)},Z.prototype.play=function(t){var n=this.sounds[t],e=n.length>1?n[Math.floor(Math.random()*n.length)]:n[0];e.pool[e.tick].play(),e.tick<e.count-1?e.tick++:e.tick=0};var mn=new Z;mn.add("laser",5,[[0,,.15,.5099,.2743,.9399,.2726,-.36,.0599,.27,.1299,.14,.4499,.4699,-.3199,,-.0399,-.4199,1,,,.0599,.0199,.5]]),mn.add("damage",3,[[3,,.0138,,.2701,.4935,,-.6881,,,,,,,,,,,1,,,,,.25],[0,,.0639,,.2425,.7582,,-.6217,,,,,,.4039,,,,,1,,,,,.25],[3,,.0948,,.2116,.7188,,-.6372,,,,,,,,,,,1,,,.2236,,.25],[3,,.1606,.5988,.2957,.1157,,-.3921,,,,,,,,,.3225,-.2522,1,,,,,.25],[3,,.1726,.2496,.2116,.0623,,-.2096,,,,,,,,,.2665,-.1459,1,,,,,.25],[3,,.1645,.7236,.3402,.0317,,,,,,,,,,,,,1,,,,,.25]]),mn.add("powerup",10,[[0,,.01,,.4384,.2,,.12,.28,1,.65,,,.0419,,,,,1,,,,,.3]]),mn.add("monster",5,[[3,.24,.34,.39,.38,.1674,,.1216,,.26,.47,-.7772,.6945,,,.7945,.4589,-.2207,1,,,,,.46]]),mn.add("monster-hit",5,[[3,,.356,.76,.47,.1,,.24,,.85,.66,,,,,,.0291,-.1671,1,,,,,.79]]),mn.add("monster-die",5,[[3,.1,.42,.4274,.2192,.1281,,-.18,.04,,,-.14,,,,,-.04,-.1999,1,-.0999,,,-.0999,.72]]);var vn,gn="[WASD]&nbsp; MOVE AROUND&nbsp;&nbsp;&nbsp;<br>[CLICK] SHOOT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>[SPACE] CLIMB TREE &nbsp;&nbsp;&nbsp;<br>[ESC]&nbsp;&nbsp; PAUSE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>",dn=document.getElementById("scene"),bn=dn.getContext("webgl"),pn=bn.createProgram(),xn={},yn={},En=document.getElementById("a"),Tn=document.getElementById("b"),An=0,Mn=100,Ln={cube:{position:x([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),normal:x([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),texture:x([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),index:y([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23])},plane:{position:x([-Mn/2,0,-Mn/2,-Mn/2,0,Mn/2,Mn/2,0,Mn/2,Mn/2,0,-Mn/2]),normal:x([0,1,0,0,1,0,0,1,0,0,1,0]),texture:x([0,Mn/4,0,0,Mn/4,0,Mn/4,Mn/4]),index:y([0,1,2,0,2,3])}},Rn=0,Un=0,wn=0,Cn="menu",zn=null;r(),bt(),nt(),$(),Ut()}();</script>
</body>
</html>