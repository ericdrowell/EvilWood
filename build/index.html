<!DOCTYPE HTML>
<html>
<head>
  <title>Evil Wood</title>
  <style>body,html{padding:0;margin:0;overflow:hidden}canvas{background-color:#000}#a{width:100%;position:fixed;top:10%;left:0;text-align:center;color:#fff;font-family:Courier New,monospace;font-size:4vh}#b{position:fixed;color:red;font-size:5vh;top:10px;left:10px;font-family:Courier New,monospace}#b span{margin-right:5px}</style>
</head>
<body>
  <canvas id="scene"></canvas></div><div id="a"></div><div id="b"></div>
  <script>!function(){function n(n){return 1/n==-1/0?-1*n:n}function t(){nt.enable(nt.DEPTH_TEST)}function e(){nt.viewport(0,0,$n.width,$n.height),nt.clear(nt.COLOR_BUFFER_BIT|nt.DEPTH_BUFFER_BIT)}function i(){var n=Un.create();Un.set(Hn,n),Kn.push(n)}function r(){if(0==Kn.length)throw"Invalid popMatrix!";Hn=Kn.pop()}function o(){m(),l(),h(),v()}function a(n,t){var e=nt.createShader(nt.FRAGMENT_SHADER);nt.shaderSource(e,n),nt.compileShader(e);var i=nt.createShader(nt.VERTEX_SHADER);nt.shaderSource(i,t),nt.compileShader(i),nt.attachShader(tt,i),nt.attachShader(tt,e),nt.linkProgram(tt),nt.getProgramParameter(tt,nt.LINK_STATUS)||alert("Could not initialize shaders"),nt.useProgram(tt),o()}function u(n,t,e){Un.perspective(n,$n.width/$n.height,t,e,Vn)}function c(){Un.identity(Hn)}function f(n,t,e){Un.translate(Hn,[n,t,e])}function s(n,t,e,i){Un.rotate(Hn,n,[t,e,i])}function g(n,t,e){Un.scale(Hn,[n,t,e])}function m(){tt.vertexPositionAttribute=nt.getAttribLocation(tt,"aVertexPosition"),nt.enableVertexAttribArray(tt.vertexPositionAttribute),tt.pMatrixUniform=nt.getUniformLocation(tt,"uPMatrix"),tt.mvMatrixUniform=nt.getUniformLocation(tt,"uMVMatrix")}function l(){tt.textureCoordAttribute=nt.getAttribLocation(tt,"aTextureCoord"),nt.enableVertexAttribArray(tt.textureCoordAttribute),tt.samplerUniform=nt.getUniformLocation(tt,"uSampler")}function h(){tt.vertexNormalAttribute=nt.getAttribLocation(tt,"aVertexNormal"),nt.enableVertexAttribArray(tt.vertexNormalAttribute),tt.nMatrixUniform=nt.getUniformLocation(tt,"uNMatrix")}function v(){tt.useLightingUniform=nt.getUniformLocation(tt,"uUseLighting"),tt.ambientColorUniform=nt.getUniformLocation(tt,"uAmbientColor"),tt.pointLightingLocationUniform=nt.getUniformLocation(tt,"uPointLightingLocation"),tt.pointLightingColorUniform=nt.getUniformLocation(tt,"uPointLightingColor"),tt.useDistanceLighWeightingUniform=nt.getUniformLocation(tt,"uUseDistanceLightWeighting")}function E(n,t){nt.pixelStorei(nt.UNPACK_FLIP_Y_WEBGL,!0),nt.bindTexture(nt.TEXTURE_2D,n),nt.texImage2D(nt.TEXTURE_2D,0,nt.RGBA,nt.RGBA,nt.UNSIGNED_BYTE,t),nt.texParameteri(nt.TEXTURE_2D,nt.TEXTURE_MAG_FILTER,nt.NEAREST),nt.texParameteri(nt.TEXTURE_2D,nt.TEXTURE_MIN_FILTER,nt.LINEAR_MIPMAP_NEAREST),nt.generateMipmap(nt.TEXTURE_2D),nt.bindTexture(nt.TEXTURE_2D,null)}function b(n){var t=nt.createBuffer();return t.numElements=n.length,nt.bindBuffer(nt.ARRAY_BUFFER,t),nt.bufferData(nt.ARRAY_BUFFER,new Float32Array(n),nt.STATIC_DRAW),t}function x(n){var t=nt.createBuffer();return t.numElements=n.length,nt.bindBuffer(nt.ELEMENT_ARRAY_BUFFER,t),nt.bufferData(nt.ELEMENT_ARRAY_BUFFER,new Uint16Array(n),nt.STATIC_DRAW),t}function p(n,t,e){nt.bindBuffer(nt.ARRAY_BUFFER,n.position),nt.vertexAttribPointer(tt.vertexPositionAttribute,3,nt.FLOAT,!1,0,0),nt.bindBuffer(nt.ARRAY_BUFFER,n.texture),nt.vertexAttribPointer(tt.textureCoordAttribute,2,nt.FLOAT,!1,0,0),nt.activeTexture(nt.TEXTURE0),nt.bindTexture(nt.TEXTURE_2D,t),nt.uniform1i(tt.samplerUniform,0),nt.uniform1i(tt.useDistanceLighWeightingUniform,e),nt.bindBuffer(nt.ELEMENT_ARRAY_BUFFER,n.index),nt.bindBuffer(nt.ARRAY_BUFFER,n.normal),nt.vertexAttribPointer(tt.vertexNormalAttribute,3,nt.FLOAT,!1,0,0)}function d(){nt.uniformMatrix4fv(tt.pMatrixUniform,!1,Vn),nt.uniformMatrix4fv(tt.mvMatrixUniform,!1,Hn);var n=Rn.create();Un.toInverseMat3(Hn,n),Rn.transpose(n),nt.uniformMatrix3fv(tt.nMatrixUniform,!1,n)}function T(n){d(),nt.drawElements(nt.TRIANGLES,n.index.numElements,nt.UNSIGNED_SHORT,0)}function A(){nt.uniform1i(tt.useLightingUniform,!0)}function y(n,t,e){nt.uniform3f(tt.ambientColorUniform,n,t,e)}function L(n,t,e){nt.uniform3f(tt.pointLightingColorUniform,n,t,e)}function M(){return"\nprecision highp float;\nvarying vec2 vTextureCoord;\nvarying vec3 vLightWeighting;\nuniform sampler2D uSampler;\nvoid main(void) {\nvec4 textureColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\ngl_FragColor = vec4(textureColor.rgb * vLightWeighting, textureColor.a);\n}"}function R(){return"\nattribute vec3 aVertexPosition;\nattribute vec3 aVertexNormal;\nattribute vec2 aTextureCoord;\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nuniform mat3 uNMatrix;\nuniform vec3 uAmbientColor;\nuniform vec3 uPointLightingLocation;\nuniform vec3 uPointLightingColor;\nuniform bool uUseLighting;\nvarying vec2 vTextureCoord;\nvarying vec3 vLightWeighting;\nuniform bool uUseDistanceLightWeighting;\nvoid main(void) {\nfloat distanceLightWeighting = 1.0;\nvec4 mvPosition = uMVMatrix * vec4(aVertexPosition, 1.0);\ngl_Position = uPMatrix * mvPosition;\nvTextureCoord = aTextureCoord;\nvec3 lightDirection = normalize(uPointLightingLocation - mvPosition.xyz);\nvec3 transformedNormal = uNMatrix * aVertexNormal;\nfloat directionalLightWeighting = max(dot(transformedNormal, lightDirection), 0.0);\nfloat mvDistance = length(uPointLightingLocation - mvPosition.xyz);\nif (uUseDistanceLightWeighting) {\ndistanceLightWeighting = pow(0.992, mvDistance*2.0);\n}\nvLightWeighting = uAmbientColor + uPointLightingColor * distanceLightWeighting;\n}"}function U(){qn={blocks:{},beacon:{},monsters:[],lasers:[],grid:{}},jn=0,k(0,0),B()}function C(n){return{x:Gn(n.x/On),y:Gn(n.y/On),z:Gn(n.z/On)}}function N(){qn.monsters.forEach(function(n,t){if(n.health<=0)n.points.forEach(function(n){D(n)}),qn.monsters.splice(t,1);else{var e=n.points[0],i=Mn.create([e.x-et.x,0,e.z-et.z]);Mn.normalize(i);var r=_n*ct/1e3;n.points.forEach(function(t){D(t),t.x+=i[0]*r*-1,t.z+=i[2]*r*-1,D(t),z(n,t)})}})}function I(){var n=Sn*ct/1e3*-1;qn.lasers.forEach(function(t,e){t.z+=Math.cos(t.yaw)*n,t.y+=Math.tan(t.pitch)*n*-1,t.x+=Math.sin(t.yaw)*n;var i=O(t);i&&"monster"===i.type&&(i.timout&&clearTimeout(i.timeout),i.isHit=!0,qn.lasers.splice(e,1),i.timeout=setTimeout(function(){i.isHit=!1,i.health-=1},100)),t.expire<=st&&qn.lasers.splice(e,1)})}function D(n){for(var t=C(n),e=-1;e<=1;e++)for(var i=-1;i<=1;i++){var r=S({x:t.x+e,y:t.y,z:t.z+i});qn.grid[r]=null}}function O(n){var t=S(C(n));return qn.grid[t]}function S(n){return n.x+":"+n.y+":"+n.z}function z(n,t){for(var e=C(t),i=-1;i<=1;i++)for(var r=-1;r<=1;r++){var o=S({x:e.x+i,y:e.y,z:e.z+r});qn.grid[o]=n}}function w(n,t){var e=C(n),i=[];t||(t=3);for(var r=-t;r<=t;r++)for(var o=-t;o<=t;o++){var a=S({x:e.x+r,y:e.y,z:e.z+o});qn.grid[a]&&i.push(qn.grid[a])}return i}function P(n){var t=w({x:n.x,y:6,z:n.z});for(var e in t)if("beacon"===t[e].type)return!0;return!1}function _(n){var t=w({x:n.x,y:0,z:n.z},5);for(var e in t)if("tree"===t[e].type)return t[e];return null}function F(n){var t=w({x:n.x,y:0,z:n.z}),e=[];for(var i in t)"monster"===t[i].type&&e.push(t[i]);return e}function B(){qn.beacon={type:"beacon",points:[{x:2*Dn*Yn()-Dn,y:6,z:2*Dn*Yn()-Dn}],rotationY:0},z(qn.beacon,qn.beacon.points[0])}function k(n,t){void 0===qn.blocks[n]&&(qn.blocks[n]={}),qn.blocks[n][t]={trees:[]};for(s=0;s<Nn;s++){for(var e=60+60*Yn(),i={type:"tree",points:[],rotationY:Yn()*Wn*2,height:e},r=n*at+Yn()*at-at/2,o=t*at+Yn()*at-at/2,a=0;a<e/4;a++){var u={x:r,y:4*a,z:o};i.points.push(u),z(i,u)}qn.blocks[n][t].trees.push(i)}if(jn>=9)for(var c=n*at+Yn()*at-at/2,f=t*at+Yn()*at-at/2,s=0;s<In;s++){for(var g={type:"monster",points:[],health:3},a=0;a<4;a++){var m={x:c,y:2*a,z:f};g.points.push(m),z(g,m)}qn.monsters.push(g)}jn++}function W(){var t=n(Gn(et.x/at)),e=n(Gn(et.z/at));return[{x:t,z:e},{x:t-1,z:e-1},{x:t,z:e-1},{x:t+1,z:e-1},{x:t+1,z:e},{x:t+1,z:e+1},{x:t,z:e+1},{x:t-1,z:e+1},{x:t-1,z:e}]}function G(){W().forEach(function(n){var t=n.x,e=n.z;void 0===qn.blocks[t]&&(qn.blocks[t]={}),void 0===qn.blocks[t][e]&&k(t,e)})}function Y(){Jn={straightMovement:0,sideMovement:0,isClimbing:!1,health:3}}function H(){if(0!==Jn.straightMovement){t=(n=1===Jn.straightMovement?-1:1)*Fn*ct/1e3;Jn.isClimbing?(et.y+=-1*t,et.y<Bn&&(et.y=Bn,Jn.isClimbing=!1),Jn.isClimbing&&et.y>mt.height+10&&(et.y=mt.height+10)):(et.z+=t*Math.cos(et.yaw),et.x+=t*Math.sin(et.yaw))}if(0!==Jn.sideMovement){var n=1===Jn.sideMovement?1:-1,t=n*Fn*ct/1e3;et.z+=t*Math.cos(et.yaw+Math.PI/2),et.x+=t*Math.sin(et.yaw+Math.PI/2)}P(et)&&"won"!==gt&&Tn(),Jn.health<=0&&"died"!==gt&&An(),F(et).forEach(function(n){n.cooldown||(V(),n.cooldown=!0,setTimeout(function(){n.cooldown=!1},1e3*Pn))})}function V(){Jn.health-=1}function K(){qn.lasers.push({x:et.x+Math.sin(et.yaw+Wn/4)*wn,y:et.y-Math.tan(et.pitch)*wn-.2*Bn,z:et.z+Math.cos(et.yaw+Wn/4)*wn,pitch:et.pitch,yaw:et.yaw,expire:1e3*(new Date/1e3+zn)})}function X(){Cn&&Cn.close(),Cn=new AudioContext,Qn.menu.gain=Cn.createGain(),Qn.play.gain=Cn.createGain(),Qn.menu.gain.connect(Cn.destination),Qn.play.gain.connect(Cn.destination),q()}function q(){Qn.menu.gain.gain.value=0,Qn.play.gain.gain.value=0}function j(n){var t=0,e=[];X(),Qn[n].gain.gain.value=.2;for(var i=0;i<50;i++)e=e.concat(Qn[n].notes);e.forEach(function(e,i){var r=e[0],o=e[1],a=e[2];J(Qn[n].gain,r,t,o),t+=a})}function J(n,t,e,i){var r=Cn.createOscillator();r.connect(n),r.frequency.value=t,r.type="square",r.start(Cn.currentTime+e),r.stop(Cn.currentTime+e+i)}function Q(){$n.width=window.innerWidth,$n.height=window.innerHeight,a(M(),R()),rn(function(){Ln()})}function Z(){rt.innerHTML="EVIL WOOD<br><br>YOU ARE LOST IN AN EVIL FOREST<br>CLIMB TREES TO SEE THE SKY<br>FIND THE RED BEACON TO ESCAPE<br>LET THE NORTH STAR GUIDE YOU<br>BEWARE THE DARK SOULS<br><br>"+Zn+"<br><br>CLICK SCREEN TO START"}function $(){rt.innerHTML="PAUSED<br><br>"+Zn+"<br>CLICK SCREEN TO CONTINUE"}function nn(){rt.innerHTML="YOU WIN!<br><br>CONGRATULATIONS ON ESCAPING EVIL WOOD<br>YOUR CUNNING, SKILL, AND BRAVERY<br>SHALL BE REMEMBERED FOR ALL TIME<br><br>CLICK SCREEN TO PLAY AGAIN"}function tn(){rt.innerHTML="YOU DIED<br><br>DARK SOULS DEVOUR YOUR BODY<br>EVIL WOOD SLOWLY FADES AWAY<br>NONE SHALL KNOW OF YOUR HORRIFIC FATE<br><br>CLICK SCREEN TO TRY AGAIN"}function en(){rt.innerHTML=""}function rn(n){it={tree:{encoding:"data:image/gif;base64,R0lGODlhEAAQAPcAAAAAAP///0RIOz9AOFBRR0REOlNTS1dWPVZVQ0RDNElIOkpJO0pJPFFQQ1RTSFZVTEE/MVFPP1NRQlRSQ1dVRkZDMktINj89MUNBNlBOQUtJPVJQQ1pYS1BNPVFOQF1aS11bUVRQPlFNPVxYR0A+NVpXS15bT2ZjV0pIQEhBJ1hROElEMVtWRF5ZR0pGOFhURlBNQkdFPkA4Hk5GLUA6J0Q+K0hCLjw3J0ZBMVxWQ1NOPkhENz88MlRQQ0lBKkY/KlhPN05IODg0KVNOP1RPQGNdTEA8MUZCNkRANUZCN1lVSV5aTkZDO0c+J0I6JzEsH05GMzYxJE5HNkU/MGhfSVpTQk9JOltUQ2JbSUpFOEZBNVdSRkhEOlpVSUM3HD4zGkg+J0Y8JkxCLEpBLEU9Kz43J0E6Ki4pHktDMTo0JkI7LDs1KEA6LFVNO0dBM1tTQklDNVxUQ1BKPEA7MFZQQlZQQ0Y5Hz0zHz41I1BFLkg+KktCL1lPOkc/L1lQPkY/MTw2KlFJOUdAMj03K0tENlhQQFpSQkZANFhRQ1dQQkM+NFROQjYmCTcpEEAzGzwxHDYsGj4zHzYtHUM5JjMrHU1CLSokGU9EMDoyJDszJU1DMUc+LTcwIz01J1RJNkI6K0Q8LVpQPTUvJFNKOUc/MUE6LUlBM0Y/MlFJOlRMPVVNP1NMP1dQQ0ZBOD0xHSggEzUrGjowHycgFT0zIj40Iz40JEg9K0M5KUA3KEE4KUI5KkxCMlBGNUA4K1FHNz84LFRLPEI7Lz85LzImFT8yH0c5JDMpGkg7J0U5JzUsHkI3JkE2Jkc7KjEpHT81Jko+LUY7KzQsIEg9LVFFNEY9L1ZLOklAMzkyKExDNk9IPk5IPzMnF0I0IUAzITcsHTMpG0s8KEM2JEU4JkE1JTQrH0c7K1JFNDoxJUk/MjstHDkuIT4zJkc8LlFGOCkdDyccEDUsIjYtIzszKlFGOjcnFzgtIjgoGTszLDYmGgAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAEAAQAAAI/wAX6OgUzVwhF4qYWMn07VKVBgrAVJJGj5mUAg/GgJNzhJcgHkRUHFN3SxkUVSb4FMtVB52yalgQ7OozIdK0dqg8qKkVihsyPzl+VOjQAw8kJFpq2GgzytUwNuRS0BCQoNcdOO+++LCwphksOLLsGAMkZlYiYJS8SIoy7lyGInIYPWJgC9QGT38aOcIRq5QEKm9k6BlwBg2LKfdohSHxZE8LESsOALFWj9AQCAQi5FlkYEmWGyE0zXCGTZOvFyVMNdEFgk65Kx/wdWNAYdIzbdnseUtiKJw4DlvYLTvEihimGHOgjTuVKh2nVvEErQuGYtsmGK/K4PolzJ0oLpbIyCQzgiFZHERpnAy6FgWekhFuPgXZcYHavC4azAQiJeTXqhMOBAQAOw=="},ground:{encoding:"data:image/gif;base64,R0lGODlhEAAQAPcAAAAAAP///2lkZSgmJ29tbjExMlhZXjM0NS8xMj1BQjM3Ny4vLyYsKyMmJVZbWScsKVdcWSwxLCYoJklMSSguJjg9NjM9LjI0MTM4MDM2MR4fHURFQz9GNzM3Li46HkJFPi48GTA+GiEnGDI3Ki8zKTs/NTg6NTY4MzM8Iz9ILzM6JzxCMjU4MDdDITQ6KSowHlJbPywwJERKODEzLTM1Lzo8NkNEQSo4Cio0EjxKGyoyFx0iEkJLLi4xJ0tQQE1QRjtGHjZAHURLMSQpFiAkFBETCxodETE2IysuIjs+Mi8xKRscGDk7M1RWTltcWDE4GTA2HTAzJjI1KDU3Lj0/NkpSKyouGzs/Kzk9Kjg6MEhKQDU5JDk8LCwuIyktFEJHKS0wHCEjFjU4Ji8xJB8gGkhKPVBSRTU6GDE0HiIkFkJFMCwuIDs9LkFDNTc4MSotFDc7Gzc6IldbOjM1Ij5AL0BCMjIzKkVGPklKQltcUywuFSUnEy8xGTM1IVVXPjQ1Kz9ANTQ2GCkqGCkqG0dIODo7JD0+JzY3Izk6JjY3JFRVOywsGjk5JzIyJS8vI0tLOEBAMjg4LSkpIUlJPzo6MyoqJlxcVFNTTCkpJklJRUVFQSQkIktLSCIhETY1I0hHNEE/KEdFLkNCNUA/M1dWSygmEzg1GzUzIUA+LUxKOU1MQk5NREA+LyUkHS0sJUpJQj47KktINzEvJFFOPTs5LV5bSTw6L0ZEN1RSRVRSR1xaTj08Nk5HIj88LC0rITs5L1hVR2FeUFxaUDQzLklIQzIuHTc0KC0rIjY0K15bTlhVSTUzLElHQE9NRjItHDw3Jz06MGplVEZDOWZjWTEsHTArHVdONkVAMVFLOjs3LDQxKFhTRTk2LU5KPk5LQnBuaC4nFkA7LmBcUlFJOD85LGBbUFVSS2BaThsaGG5qYkM6Ky8pH0hBNUNAO0tJRlRSTzcsHUY4JTctID86M2BbVD06NkpGQVBMSDYxLwAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAEAAQAAAI/wDXUAghhAuNA12iUIHGTdo4a9ES1OiAIUODB0kiMPAB6ZAWAxDy6JpWiQyaQvgwzXkCJ44KB2WwBcN1zMgZXvGeBXqjCE+PPsVGMWMyJlEbG8tkDYoxwR0xZI5mDFMmZpIZDiNu0WFjgcW8VSVOOLnERMGRLzBWsLliRUSaKRU4bViioYgJAnJugIFS6hQjVzOQkEDma5MEN7MQ1WnBQw0le9mIvLBFrpqxXa/ubeNjKJS8cKyUhPECKJcwVY9qxfpkChw1T7R+rduDpcmGRr3OJfPTTdsfVKngqZM0RE+nRa3qtYNF7504UtnYRbpjZ4cOKQguLEDX7Fs6Qls+uCSQQQMEjgGasnC7BsySOVBAcqTwICgIigKZflDxVs6ZKAFVBAQAOw=="},leaves:{encoding:"data:image/gif;base64,R0lGODlhEAAQAPcAAAAAAP///09gF0tXFVNgGUFKF1FcFkBID1hiFUhRE0ZOC0xUD01VEkdNE19oGk9WF1VdDkFGCzc7CjtAC1RbEGFpEzM3ClRaEzg8DU5TFVFWF1NZHEFFFmpwJD9DCjs+C1NYEVNXEk1SEj9CD0pOFnl+JVldHE9TG1daEVteE05REUlMEERHD1xfFUdJE2ltHVRWF0lLFVlcGl9iHFNVG2BjIFZYHVFTH0BBCT0+CT0+DVJUEkhJEFxdFUlKEUxNE11eGFtcGWprHy8wEDQ1ElpbIF9gJSEhAjAwCTg4C0pKD0VFDlNTEUlJDzs7DVdWFFVVFEREFElJFlVVGl1dHVpaHEtLGC0sBUxKElNRFkA/EUJBElBPFkFAEmRiHD08EVNRGUtJF1pYHEpJGUxLGmBeITY0CTAuCUE+DUpHEUZEE1JPF0hGFkhFFkdFF2RhImViI0VDGEZEGlNRIiEfAzMwCExHEDUyCz47Djs4DjIvDFNOFTw5D0xIFURAFE9LGExIF01JGEdDFmRfIFpVHVhTHTUxBzUxCkA7DUI9D0dCEUZBEkE8EUpFFEdCFElEFUE9E1BLGEM+FFNOHDw4Fz44DTs2DjItDElCE0E7E1lRHE9IGUU/F0I9Fjs2FFRNHVJMHU9JHEZBGldRIiUgATkyC0pCDzcxCy4pCiUhCC8qCzEsDFJJGFtSHVdOHE1GHElCG15WI1VNICwmCUM7EVlPGjQuEUtDGTkzEzEsEVNKIGJYJllQIzIqCkE4EUA4FEY9GE1EHEpBGzs0FlVLIFNJIVFIIicgBzMrDDsyEUtAF0tBHVZNKjYtED81E1RHHkc8GkU7G0k/HyAZBiUeCUw+FzMqEE1AGUQ5GkI4HDsyGUk7FjgtEkQ3GEQ5HDwwFCYeDS4lEE9AHUw+HUk9I2BSMjwuEzwvFkk6G08/H0s8IldGK1tILDouHVRCKUo4IVE/LDYoG0ExJQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAEAAQAAAI/wBvZIDxI5WFBhgc1GBgwogBAQTwOIlz7pAHJEmW8CBDwgWHARvYaJjhZZA4c6UwRaqyIoeWObFGoRBSwRGrWug0AXkCZQcIWLw2MXkh40sQU48mZdkTJhQVN8DAiCEErcuCP+s4pXnGbhcVLsxoFCLWRpQOG+UYfXgFb5ydFG+KCZIkDFs4da6q+Ukgy1kzR33MXEF16lg7d+mUoYkAiBY1PXzItUr0LV60MNI8SUiCK9MvLIvkZSvV7d01HKC8WTuzxVgwNchyrZrVy5AiX6Rscet0okifQ9OG3VJy51KlZOC0hZgyqkUQRFfgfFLRRNWjNcu29RBRpkSQBxCiHCQYAinGmEZ1jljygaCDLkp5iBQYYUUOHVWqJrBQQOFCICkjBAQAOw=="},red:{encoding:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z8DwHwAFBQIAX8jx0gAAAABJRU5ErkJggg=="},shadow:{encoding:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkqAcAAIUAgUW0RjgAAAAASUVORK5CYII="},monster:{encoding:"data:image/gif;base64,R0lGODlhEAAQAPcAAAAAAP///186h2Y/j187iFo4hlU1f2A8jlg3glY2flg4gWI/j148iVk4h1Y2glQ1f1AyeFc3g1U2gVI0fFk5hlc4hFQ2f1s6h1g4g1w7iVk6hl49jFE1eUMpaUUrbUMqak4xeVE0f1I0f1AzfU8ye0swdkwwdlI0fkwxd0swdEgucFY3hFI1gE8ze0wxdkowc1k5iFU3g1A0fFc5hlQ3glI2f1M2f1Q3gVA0elA0eVc6hVY5g1Q4gVU4gUAoakUscUYscU8yf0gudEUsb0MrbD4oZU0yfU4yfEgvdEUtb0IrakwyekwxeEgvc0QsbFE1gU80flA0fk4zfE0yeUsxd0kwdUowdUYucE4ze0wyeEoxdkQtbE80fE4zekkwckIsaVY5hlI2gE40e0wzeEgwcVI3gVE2fksydVQ4gjokYj0nZz4oaTgkXz4oZkUtcUQsb0ErbEIrbEAqakwyfUgvdUAqaUIsbUMsbUgwdkkwdkUucUQtbkkxd0Yvck41f000fUwze0syeEYvcUUub041fkszekkxdUw0e000e0kydk00ek41e0w0eUozdkw0dzUhXjIfWDgkYDwnZjomZD4paz8qbDomYj8qakUvdUYvdUAraz0pZkUvdEQuckEsbUcwdkMucUItbj8raUkyeUYwdEQvckItbUAsa001gEoze0sze0gyeEkyeEcxdkYwc0QvcU01fkozeUkyd0YwckQvcE02f0ozeEUwcUs0ek83f0s0eTIgXTckZDglZTckYTwoaDknZTclYEArbz4qbDsoZkItcTwpZz8razooZEIuckEtb0AsbD4raUs0fkUwdUQwdD8saz0raD4raEcyeEQwc0MvcUIub0MvcEs1fEUxc0QxcjQkXzUkXzspaTQkXTkoZj0razopZkAtbzopZUQyc0Y0dSkbUTQlXgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAEAAQAAAI/wAJJJgSQxmxQmBOgLCQ5ZkzKCsgmJDwZpuxG6ps2UljKxuRHmKaTAjRqtygB6uooSrFbBIHL90+MbpWjVQXIy0cwZp27lghaGOQWANHi04UGFTuXHDSBk8mU3cMsRKWBMMBDVYEEDBVgcUoMm3UcMJEggETYGdKwNnly5W4LBGWFeNhIAwvSdLMfQvWQUgyQDM05VLyYQmlWIg8vdKWw4AsQlKA2JhFo1OVFi4qOJjDZwu0PjbicKlhxpcHBYKONChAY5g1RUNOhUv0hU2dIleQbUITpBmtRT+eUCPnLZQuFQh2jNMi4hAoQ7VG6PjVB5soSy8W7Im0AUujMn4yZCTx0SIVLjnRUgxow03OpT951vR6pGdUp1sU3MhAAQlHoG6VBAQAOw=="},orange:{encoding:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8v57hPwAHEgKv3MuCuAAAAABJRU5ErkJggg=="},white:{encoding:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII="}};var t=0,e=0;for(var i in it)!function(){e++;var r=it[i],o=r.glTexture=nt.createTexture(),a=r.image=new Image;a.onload=function(){E(o,a),++t>=e&&n()},a.src=r.encoding}()}function on(){var n=qn.beacon.points[0];if("won"!==gt){i(),f(n.x,n.y,n.z),p(ut.cube,it.red.glTexture,!1),T(ut.cube),r(),i(),f(n.x,-1.99,n.z),p(ut.cube,it.shadow.glTexture,!0),T(ut.cube),r();var t=Mn.create([n.x-et.x,0,n.z-et.z]);Mn.normalize(t),i(),f(et.x,140,et.z),f(t[0]*kn,0,t[2]*kn),p(ut.cube,it.orange.glTexture,!1),T(ut.cube),r()}}function an(){qn.monsters.forEach(function(n){var t=n.isHit?"white":"monster";n.points.forEach(function(n){i(),f(n.x,n.y,n.z),p(ut.cube,it[t].glTexture,!0),T(ut.cube),r()})})}function un(n,t){i(),f(n*at,-1.1,t*at),p(ut.plane,it.ground.glTexture,!0),T(ut.plane),r()}function cn(n,t){if(qn.blocks[n]&&qn.blocks[n][t])for(var e=qn.blocks[n][t].trees,o=0;o<e.length;o++){var a=e[o];a.points.forEach(function(n){i(),f(n.x,n.y,n.z),s(a.rotationY,0,1,0),g(2,2,2),p(ut.cube,it.tree.glTexture,!0),T(ut.cube),r()});var u=a.points[a.points.length-1],c=u.x,m=u.y,l=u.z;Xn.forEach(function(n){i(),f(c+8*n[0],m+8*n[2],l+8*n[1]),g(4,4,4),p(ut.cube,it.leaves.glTexture,!0),T(ut.cube),r()})}}function fn(){for(var n="",t=0;t<Jn.health;t++)n+="<span>&hearts;</span>";ot.innerHTML=n}function sn(){W().forEach(function(n){var t=n.x,e=n.z;un(t,e),cn(t,e)})}function gn(){qn.lasers.forEach(function(n){i(),f(n.x,n.y,n.z),s(n.yaw,0,1,0),s(n.pitch,1,0,0),g(.2,.2,5),p(ut.cube,it.orange.glTexture,!1),T(ut.cube),r()})}function mn(){e(),u(45,.1,150),c(),A(),y(0,0,0),L(.9,.9,.9),s(-et.pitch,1,0,0),s(-et.yaw,0,1,0),f(-et.x,-et.y,-et.z),fn(),sn(),on(),an(),gn()}function ln(){U(),Y(),gt="menu",j("menu"),et={x:0,y:Bn,z:0,pitch:0,yaw:0},Z()}function hn(n){switch(n.which||n.keyCode){case 65:"playing"===gt&&(Jn.sideMovement=-1);break;case 87:"playing"===gt&&(Jn.straightMovement=1);break;case 68:"playing"===gt&&(Jn.sideMovement=1);break;case 83:"playing"===gt&&(Jn.straightMovement=-1);break;case 32:"playing"===gt&&(mt=_(et))&&(Jn.straightMovement=1,Jn.isClimbing=!0)}}function vn(n){switch(n.which||n.keyCode){case 65:Jn.sideMovement=0;break;case 87:Jn.straightMovement=0;break;case 68:Jn.sideMovement=0;break;case 83:Jn.straightMovement=0;break;case 32:Jn.isClimbing&&(Jn.straightMovement=0)}}function En(n){bn()&&(et.pitch+=n.movementY*Wn*.001*-1,et.pitch>Wn/2&&(et.pitch=Wn/2),et.pitch<-1*Wn/2&&(et.pitch=-1*Wn/2),et.yaw+=n.movementX*Wn*.001*-1)}function bn(){return document.pointerLockElement===$n}function xn(n){"menu"===gt||"paused"===gt?pn():"playing"===gt?K():"won"!==gt&&"died"!==gt||ln()}function pn(){gt="playing",$n.requestPointerLock(),en(),j("play")}function dn(){gt="paused",j("menu"),$()}function Tn(){document.exitPointerLock(),gt="won",j("menu"),ln(),nn()}function An(){document.exitPointerLock(),gt="died",j("menu"),ln(),tn()}function yn(){document.addEventListener("keydown",function(n){hn(n)},!1),document.addEventListener("keyup",function(n){vn(n)},!1),document.addEventListener("mousemove",function(n){En(n)},!1),document.addEventListener("click",function(n){xn(n)},!1),document.addEventListener("pointerlockchange",function(n){bn()||"playing"!==gt||dn()},!1)}function Ln(){st=(new Date).getTime(),0!==ft&&(ct=st-ft),"playing"===gt&&(H(),I(),N(),G(!0)),mn(),ft=st,window.requestAnimationFrame(Ln)}glMatrixArrayType="undefined"!=typeof Float32Array?Float32Array:"undefined"!=typeof WebGLFloatArray?WebGLFloatArray:Array;var Mn={};Mn.create=function(n){var t=new glMatrixArrayType(3);return n&&(t[0]=n[0],t[1]=n[1],t[2]=n[2]),t},Mn.scale=function(n,t,e){return e&&n!=e?(e[0]=n[0]*t,e[1]=n[1]*t,e[2]=n[2]*t,e):(n[0]*=t,n[1]*=t,n[2]*=t,n)},Mn.normalize=function(n,t){t||(t=n);var e=n[0],i=n[1],r=n[2],o=Math.sqrt(e*e+i*i+r*r);return o?1==o?(t[0]=e,t[1]=i,t[2]=r,t):(o=1/o,t[0]=e*o,t[1]=i*o,t[2]=r*o,t):(t[0]=0,t[1]=0,t[2]=0,t)},Mn.direction=function(n,t,e){e||(e=n);var i=n[0]-t[0],r=n[1]-t[1];return n=n[2]-t[2],(t=Math.sqrt(i*i+r*r+n*n))?(t=1/t,e[0]=i*t,e[1]=r*t,e[2]=n*t,e):(e[0]=0,e[1]=0,e[2]=0,e)};var Rn={};Rn.create=function(n){var t=new glMatrixArrayType(9);return n&&(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9]),t},Rn.transpose=function(n,t){if(!t||n==t){var e=n[1],i=n[2],r=n[5];return n[1]=n[3],n[2]=n[6],n[3]=e,n[5]=n[7],n[6]=i,n[7]=r,n}return t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8],t};var Un={};Un.set=function(n,t){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},Un.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},Un.create=function(n){var t=new glMatrixArrayType(16);return n&&(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t},Un.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},Un.toMat3=function(n,t){return t||(t=Rn.create()),t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[4],t[4]=n[5],t[5]=n[6],t[6]=n[8],t[7]=n[9],t[8]=n[10],t},Un.toInverseMat3=function(n,t){var e=n[0],i=n[1],r=n[2],o=n[4],a=n[5],u=n[6],c=n[8],f=n[9],s=n[10],g=s*a-u*f,m=-s*o+u*c,l=f*o-a*c,h=e*g+i*m+r*l;return h?(h=1/h,t||(t=Rn.create()),t[0]=g*h,t[1]=(-s*i+r*f)*h,t[2]=(u*i-r*a)*h,t[3]=m*h,t[4]=(s*e-r*c)*h,t[5]=(-u*e+r*o)*h,t[6]=l*h,t[7]=(-f*e+i*c)*h,t[8]=(a*e-i*o)*h,t):null},Un.multiply=function(n,t,e){e||(e=n);var i=n[0],r=n[1],o=n[2],a=n[3],u=n[4],c=n[5],f=n[6],s=n[7],g=n[8],m=n[9],l=n[10],h=n[11],v=n[12],E=n[13],b=n[14];n=n[15];var x=t[0],p=t[1],d=t[2],T=t[3],A=t[4],y=t[5],L=t[6],M=t[7],R=t[8],U=t[9],C=t[10],N=t[11],I=t[12],D=t[13],O=t[14];return t=t[15],e[0]=x*i+p*u+d*g+T*v,e[1]=x*r+p*c+d*m+T*E,e[2]=x*o+p*f+d*l+T*b,e[3]=x*a+p*s+d*h+T*n,e[4]=A*i+y*u+L*g+M*v,e[5]=A*r+y*c+L*m+M*E,e[6]=A*o+y*f+L*l+M*b,e[7]=A*a+y*s+L*h+M*n,e[8]=R*i+U*u+C*g+N*v,e[9]=R*r+U*c+C*m+N*E,e[10]=R*o+U*f+C*l+N*b,e[11]=R*a+U*s+C*h+N*n,e[12]=I*i+D*u+O*g+t*v,e[13]=I*r+D*c+O*m+t*E,e[14]=I*o+D*f+O*l+t*b,e[15]=I*a+D*s+O*h+t*n,e},Un.translate=function(n,t,e){var i=t[0],r=t[1];if(t=t[2],!e||n==e)return n[12]=n[0]*i+n[4]*r+n[8]*t+n[12],n[13]=n[1]*i+n[5]*r+n[9]*t+n[13],n[14]=n[2]*i+n[6]*r+n[10]*t+n[14],n[15]=n[3]*i+n[7]*r+n[11]*t+n[15],n;var o=n[0],a=n[1],u=n[2],c=n[3],f=n[4],s=n[5],g=n[6],m=n[7],l=n[8],h=n[9],v=n[10],E=n[11];return e[0]=o,e[1]=a,e[2]=u,e[3]=c,e[4]=f,e[5]=s,e[6]=g,e[7]=m,e[8]=l,e[9]=h,e[10]=v,e[11]=E,e[12]=o*i+f*r+l*t+n[12],e[13]=a*i+s*r+h*t+n[13],e[14]=u*i+g*r+v*t+n[14],e[15]=c*i+m*r+E*t+n[15],e},Un.scale=function(n,t,e){var i=t[0],r=t[1];return t=t[2],e&&n!=e?(e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=n[3]*i,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=n[7]*r,e[8]=n[8]*t,e[9]=n[9]*t,e[10]=n[10]*t,e[11]=n[11]*t,e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e):(n[0]*=i,n[1]*=i,n[2]*=i,n[3]*=i,n[4]*=r,n[5]*=r,n[6]*=r,n[7]*=r,n[8]*=t,n[9]*=t,n[10]*=t,n[11]*=t,n)},Un.rotate=function(n,t,e,i){var r=e[0],o=e[1];e=e[2];var a=Math.sqrt(r*r+o*o+e*e);if(!a)return null;1!=a&&(r*=a=1/a,o*=a,e*=a);var u=Math.sin(t),c=Math.cos(t),f=1-c;t=n[0],a=n[1];var s=n[2],g=n[3],m=n[4],l=n[5],h=n[6],v=n[7],E=n[8],b=n[9],x=n[10],p=n[11],d=r*r*f+c,T=o*r*f+e*u,A=e*r*f-o*u,y=r*o*f-e*u,L=o*o*f+c,M=e*o*f+r*u,R=r*e*f+o*u;return r=o*e*f-r*u,o=e*e*f+c,i?n!=i&&(i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]):i=n,i[0]=t*d+m*T+E*A,i[1]=a*d+l*T+b*A,i[2]=s*d+h*T+x*A,i[3]=g*d+v*T+p*A,i[4]=t*y+m*L+E*M,i[5]=a*y+l*L+b*M,i[6]=s*y+h*L+x*M,i[7]=g*y+v*L+p*M,i[8]=t*R+m*r+E*o,i[9]=a*R+l*r+b*o,i[10]=s*R+h*r+x*o,i[11]=g*R+v*r+p*o,i},Un.frustum=function(n,t,e,i,r,o,a){a||(a=Un.create());var u=t-n,c=i-e,f=o-r;return a[0]=2*r/u,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*r/c,a[6]=0,a[7]=0,a[8]=(t+n)/u,a[9]=(i+e)/c,a[10]=-(o+r)/f,a[11]=-1,a[12]=0,a[13]=0,a[14]=-o*r*2/f,a[15]=0,a},Un.perspective=function(n,t,e,i,r){return n=e*Math.tan(n*Math.PI/360),t*=n,Un.frustum(-t,t,-n,n,e,i,r)};var Cn,Nn=5,In=1,Dn=100,On=2,Sn=200,zn=1,wn=2,Pn=1,_n=10,Fn=40,Bn=6,kn=100,Wn=Math.PI,Gn=Math.round,Yn=Math.random,Hn=Un.create(),Vn=Un.create(),Kn=[],Xn=[[-1,-2,-2],[0,-2,-2],[1,-2,-2],[-2,-1,-2],[-1,-1,-1],[0,-1,-1],[1,-1,-1],[2,-1,-2],[-2,0,-2],[-1,0,-1],[1,0,-1],[2,0,-2],[-2,1,-2],[-1,1,-1],[0,1,-1],[1,1,-1],[2,1,-2],[-1,2,-2],[0,2,-2],[1,2,-2],[0,0,0]],qn={},jn=0,Jn={},Qn={menu:{notes:[[61.74,.13,.15],[61.74,.13,.3],[61.74,.13,.3],[61.74,.13,.15],[61.74,.13,.15],[61.74,.13,.15],[61.74,.13,.3],[61.74,.13,.3],[61.74,.13,.6],[51.91,.13,.15],[51.91,.13,.3],[51.91,.13,.3],[51.91,.13,.15],[51.91,.13,.15],[51.91,.13,.15],[51.91,.13,.3],[51.91,.13,.3],[51.91,.13,.6],[41.2,.13,.15],[41.2,.13,.3],[41.2,.13,.3],[41.2,.13,.15],[41.2,.13,.15],[41.2,.13,.15],[41.2,.13,.3],[41.2,.13,.3],[41.2,.13,.6],[61.74,.13,.15],[61.74,.13,.3],[61.74,.13,.3],[61.74,.13,.15],[61.74,.13,.15],[61.74,.13,.15],[61.74,.13,.3],[61.74,.13,.3],[61.74,.13,.6]]},play:{notes:[[65.41,.3,.5],[65.41,.3,.5],[65.41,.15,.25],[69.3,.15,.25],[65.41,.3,.5],[65.41,.15,.25],[69.3,.15,.25],[65.41,.15,.25],[61.74,.15,.25],[65.41,.3,1]]}},Zn="[WASD]&nbsp; MOVE AROUND&nbsp;&nbsp;&nbsp;<br>[CLICK] SHOOT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>[SPACE] CLIMB TREE &nbsp;&nbsp;&nbsp;<br>[ESC]&nbsp;&nbsp; PAUSE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>",$n=document.getElementById("scene"),nt=$n.getContext("webgl"),tt=nt.createProgram(),et={},it={},rt=document.getElementById("a"),ot=document.getElementById("b"),at=100,ut={cube:{position:b([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),normal:b([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),texture:b([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),index:x([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23])},plane:{position:b([-at/2,0,-at/2,-at/2,0,at/2,at/2,0,at/2,at/2,0,-at/2]),normal:b([0,1,0,0,1,0,0,1,0,0,1,0]),texture:b([0,at/4,0,0,at/4,0,at/4,at/4]),index:x([0,1,2,0,2,3])}},ct=0,ft=0,st=0,gt="menu",mt=null;t(),ln(),Q(),yn()}();</script>
</body>
</html>