<!DOCTYPE HTML>
<html>
<head>
  <title>Evil Wood</title>
  <style>body,html{padding:0;margin:0;overflow:hidden}canvas{background-color:#000}#a{width:100%;position:fixed;top:10%;left:0;text-align:center;color:#fff;font-family:Courier New,monospace;font-size:4vh}#b{position:fixed;color:red;font-size:5vh;top:10px;left:10px;font-family:Courier New,monospace}#b span{margin-right:5px}</style>
</head>
<body>
  <canvas id="scene"></canvas></div><div id="a"></div><div id="b"></div>
  <script>!function(){function t(){this.setSettings=function(t){for(var e=0;e<24;e++)this[String.fromCharCode(97+e)]=t[e]||0;this.c<.01&&(this.c=.01);var n=this.b+this.c+this.e;if(n<.18){var r=.18/n;this.b*=r,this.c*=r,this.e*=r}}}function e(t){return 1/t==-1/0?-1*t:t}function n(t){return t[Math.floor(ae()*t.length)]}function r(){Te.enable(Te.DEPTH_TEST)}function i(){Te.viewport(0,0,Ee.width,Ee.height),Te.clear(Te.COLOR_BUFFER_BIT|Te.DEPTH_BUFFER_BIT)}function o(){var t=Nt.create();Nt.set(ce,t),se.push(t)}function a(){if(0==se.length)throw"Invalid popMatrix!";ce=se.pop()}function c(){v(),g(),d(),p()}function u(t,e){var n=Te.createShader(Te.FRAGMENT_SHADER);Te.shaderSource(n,t),Te.compileShader(n);var r=Te.createShader(Te.VERTEX_SHADER);Te.shaderSource(r,e),Te.compileShader(r),Te.attachShader(Ae,r),Te.attachShader(Ae,n),Te.linkProgram(Ae),Te.getProgramParameter(Ae,Te.LINK_STATUS)||alert("Could not initialize shaders"),Te.useProgram(Ae),c()}function s(t,e,n){Nt.perspective(t,Ee.width/Ee.height,e,n,ue)}function f(){Nt.identity(ce)}function l(t,e,n){Nt.translate(ce,[t,e,n])}function m(t,e,n,r){Nt.rotate(ce,t,[e,n,r])}function h(t,e,n){Nt.scale(ce,[t,e,n])}function v(){Ae.vertexPositionAttribute=Te.getAttribLocation(Ae,"aVertexPosition"),Te.enableVertexAttribArray(Ae.vertexPositionAttribute),Ae.pMatrixUniform=Te.getUniformLocation(Ae,"uPMatrix"),Ae.mvMatrixUniform=Te.getUniformLocation(Ae,"uMVMatrix")}function g(){Ae.textureCoordAttribute=Te.getAttribLocation(Ae,"aTextureCoord"),Te.enableVertexAttribArray(Ae.textureCoordAttribute),Ae.samplerUniform=Te.getUniformLocation(Ae,"uSampler")}function d(){Ae.vertexNormalAttribute=Te.getAttribLocation(Ae,"aVertexNormal"),Te.enableVertexAttribArray(Ae.vertexNormalAttribute),Ae.nMatrixUniform=Te.getUniformLocation(Ae,"uNMatrix")}function p(){Ae.useLightingUniform=Te.getUniformLocation(Ae,"uUseLighting"),Ae.ambientColorUniform=Te.getUniformLocation(Ae,"uAmbientColor"),Ae.pointLightingLocationUniform=Te.getUniformLocation(Ae,"uPointLightingLocation"),Ae.pointLightingColorUniform=Te.getUniformLocation(Ae,"uPointLightingColor"),Ae.useDistanceLighWeightingUniform=Te.getUniformLocation(Ae,"uUseDistanceLightWeighting")}function b(t,e){Te.pixelStorei(Te.UNPACK_FLIP_Y_WEBGL,!0),Te.bindTexture(Te.TEXTURE_2D,t),Te.texImage2D(Te.TEXTURE_2D,0,Te.RGBA,Te.RGBA,Te.UNSIGNED_BYTE,e),Te.texParameteri(Te.TEXTURE_2D,Te.TEXTURE_MAG_FILTER,Te.NEAREST),Te.texParameteri(Te.TEXTURE_2D,Te.TEXTURE_MIN_FILTER,Te.LINEAR_MIPMAP_NEAREST),Te.generateMipmap(Te.TEXTURE_2D),Te.bindTexture(Te.TEXTURE_2D,null)}function x(t){var e=Te.createBuffer();return e.numElements=t.length,Te.bindBuffer(Te.ARRAY_BUFFER,e),Te.bufferData(Te.ARRAY_BUFFER,new Float32Array(t),Te.STATIC_DRAW),e}function y(t){var e=Te.createBuffer();return e.numElements=t.length,Te.bindBuffer(Te.ELEMENT_ARRAY_BUFFER,e),Te.bufferData(Te.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),Te.STATIC_DRAW),e}function E(t,e,n){Te.bindBuffer(Te.ARRAY_BUFFER,t.position),Te.vertexAttribPointer(Ae.vertexPositionAttribute,3,Te.FLOAT,!1,0,0),Te.bindBuffer(Te.ARRAY_BUFFER,t.texture),Te.vertexAttribPointer(Ae.textureCoordAttribute,2,Te.FLOAT,!1,0,0),Te.activeTexture(Te.TEXTURE0),Te.bindTexture(Te.TEXTURE_2D,e),Te.uniform1i(Ae.samplerUniform,0),Te.uniform1i(Ae.useDistanceLighWeightingUniform,n),Te.bindBuffer(Te.ELEMENT_ARRAY_BUFFER,t.index),Te.bindBuffer(Te.ARRAY_BUFFER,t.normal),Te.vertexAttribPointer(Ae.vertexNormalAttribute,3,Te.FLOAT,!1,0,0)}function T(){Te.uniformMatrix4fv(Ae.pMatrixUniform,!1,ue),Te.uniformMatrix4fv(Ae.mvMatrixUniform,!1,ce);var t=It.create();Nt.toInverseMat3(ce,t),It.transpose(t),Te.uniformMatrix3fv(Ae.nMatrixUniform,!1,t)}function A(t){T(),Te.drawElements(Te.TRIANGLES,t.index.numElements,Te.UNSIGNED_SHORT,0)}function M(){Te.uniform1i(Ae.useLightingUniform,!0)}function L(t,e,n){Te.uniform3f(Ae.ambientColorUniform,t,e,n)}function R(t,e,n){Te.uniform3f(Ae.pointLightingColorUniform,t,e,n)}function w(){return"\nprecision highp float;\nvarying vec2 vTextureCoord;\nvarying vec3 vLightWeighting;\nuniform sampler2D uSampler;\nvoid main(void) {\nvec4 textureColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\ngl_FragColor = vec4(textureColor.rgb * vLightWeighting, textureColor.a);\n}"}function U(){return"\nattribute vec3 aVertexPosition;\nattribute vec3 aVertexNormal;\nattribute vec2 aTextureCoord;\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nuniform mat3 uNMatrix;\nuniform vec3 uAmbientColor;\nuniform vec3 uPointLightingLocation;\nuniform vec3 uPointLightingColor;\nuniform bool uUseLighting;\nvarying vec2 vTextureCoord;\nvarying vec3 vLightWeighting;\nuniform bool uUseDistanceLightWeighting;\nvoid main(void) {\nfloat distanceLightWeighting = 1.0;\nvec4 mvPosition = uMVMatrix * vec4(aVertexPosition, 1.0);\ngl_Position = uPMatrix * mvPosition;\nvTextureCoord = aTextureCoord;\nvec3 lightDirection = normalize(uPointLightingLocation - mvPosition.xyz);\nvec3 transformedNormal = uNMatrix * aVertexNormal;\nfloat directionalLightWeighting = max(dot(transformedNormal, lightDirection), 0.0);\nfloat mvDistance = length(uPointLightingLocation - mvPosition.xyz);\nif (uUseDistanceLightWeighting) {\ndistanceLightWeighting = pow(0.992, mvDistance*2.0);\n}\nvLightWeighting = uAmbientColor + uPointLightingColor * distanceLightWeighting;\n}"}function C(){le={blocks:{},beacon:{},monsters:[],lasers:[],grid:{}},me=0,G(0,0),K(),H()}function z(t){return{x:oe(t.x/Yt),y:oe(t.y/Yt),z:oe(t.z/Yt)}}function S(){var t=le.beacon,e=Zt*ie*2*Se/1e3;t.rotationY+=e;var n=Ft*Se/1e3,r=Math.atan(n/kt);t.orbitY+=r,N(t),t.x=Math.cos(t.orbitY)*kt,t.z=Math.sin(t.orbitY)*kt,_(le.beacon,le.beacon)}function D(){le.monsters.forEach(function(t,e){if(t.health<=0)t.points.forEach(function(t){N(t)}),le.monsters.splice(e,1),ge.play("monster-die");else{var n=t.points[0],r=Dt.create([n.x-Me.x,0,n.z-Me.z]);Dt.normalize(r);var i=(0===t.points[0].y?Gt:qt)*Se/1e3;if(ae()<te&&0===t.verticalVelocity){t.verticalVelocity=ae()*(ee-ne)+ne;var o=Math.sqrt(Math.pow(Me.x-t.points[0].x,2)+Math.pow(Me.y-t.points[0].y,2)+Math.pow(Me.z-t.points[0].z,2));(o-=50)<1&&(o=1),volume=1/o,volume<.1&&(volume=.1),ge.play("monster-jump",volume)}var a=t.verticalVelocity*Se/1e3;t.verticalVelocity-=re*(Se/1e3),t.points.forEach(function(e,n){N(e),e.x+=r[0]*i*-1,e.y+=a,e.z+=r[2]*i*-1,e.y<2*n&&(e.y=2*n,t.verticalVelocity=0),N(e),_(t,e)})}})}function I(){var t=Bt*Se/1e3*-1;le.lasers.forEach(function(e,n){var r=e.pitch+ie/2,i=e.yaw;e.x+=Math.sin(i)*Math.sin(r)*t,e.y+=Math.cos(r)*t,e.z+=Math.cos(i)*Math.sin(r)*t;var o=P(e);o&&"monster"===o.type&&(o.timout&&clearTimeout(o.timeout),o.isHit=!0,le.lasers.splice(n,1),o.timeout=setTimeout(function(){o.isHit=!1,o.health-=1,ge.play("damage")},Jt)),B(e)&&(le.lasers.splice(n,1),ge.play("damage")),e.y<=0&&(le.lasers.splice(n,1),ge.play("damage")),e.expire<=Ie&&le.lasers.splice(n,1)})}function N(t){for(var e=z(t),n=-1;n<=1;n++)for(var r=-1;r<=1;r++){var i=O({x:e.x+n,y:e.y,z:e.z+r});le.grid[i]=null}}function P(t){var e=O(z(t));return le.grid[e]}function O(t){return t.x+":"+t.y+":"+t.z}function _(t,e){for(var n=z(e),r=-1;r<=1;r++)for(var i=-1;i<=1;i++){var o=O({x:n.x+r,y:n.y,z:n.z+i});le.grid[o]=t}}function k(t,e){for(var n=z(t),r=[],i=-e;i<=e;i++)for(var o=-e;o<=e;o++)for(var a=-e;a<=e;a++){var c=O({x:n.x+i,y:n.y+o,z:n.z+a});le.grid[c]&&r.push(le.grid[c])}return r}function F(t,e){for(var n=z(t),r=[],i=-e;i<=e;i++){var o=O({x:n.x,y:n.y+i,z:n.z});le.grid[o]&&r.push(le.grid[o])}return r}function Y(){var t=k({x:Me.x,y:6,z:Me.z},3);for(var e in t)if("beacon"===t[e].type)return!0;return!1}function B(t){var e=F(t,1);for(var n in e)if("tree"===e[n].type)return!0;return!1}function V(){var t=k(Me,5);for(var e in t)if("tree"===t[e].type)return t[e];return null}function W(){var t=k(Me,3),e=[];for(var n in t)"monster"===t[n].type&&e.push(t[n]);return e}function H(){var t=ae()*ie*2;le.beacon={type:"beacon",x:Math.cos(t)*kt,y:6,z:Math.sin(t)*kt,rotationY:0,orbitY:t},_(le.beacon,le.beacon)}function G(t,e){void 0===le.blocks[t]&&(le.blocks[t]={}),le.blocks[t][e]={trees:[]};for(var n=0;n<Ot;n++){for(var r=60+60*ae(),i={type:"tree",points:[],rotationY:ae()*ie*2,height:r},o=t*Ce+ae()*Ce-Ce/2,a=e*Ce+ae()*Ce-Ce/2,c=0;c<r/4;c++){var u={x:o,y:4*c,z:a};i.points.push(u),_(i,u)}le.blocks[t][e].trees.push(i)}if(me>=9&&ae()<=_t){for(var s=t*Ce+ae()*Ce-Ce/2,f=e*Ce+ae()*Ce-Ce/2,l={type:"monster",points:[],health:3,verticalVelocity:0},c=0;c<4;c++){var m={x:s,y:2*c,z:f};l.points.push(m),_(l,m)}le.monsters.push(l)}me++}function q(){var t=e(oe(Me.x/Ce)),n=e(oe(Me.z/Ce));return[{x:t,z:n},{x:t-1,z:n-1},{x:t,z:n-1},{x:t+1,z:n-1},{x:t+1,z:n},{x:t+1,z:n+1},{x:t,z:n+1},{x:t-1,z:n+1},{x:t-1,z:n}]}function K(){q().forEach(function(t){var e=t.x,n=t.z;void 0===le.blocks[e]&&(le.blocks[e]={}),void 0===le.blocks[e][n]&&G(e,n)})}function X(){he={straightMovement:0,sideMovement:0,isClimbing:!1,health:7}}function j(){var t={x:Me.x,y:Me.y,z:Me.z};if(0!==he.straightMovement){var e=1===he.straightMovement?-1:1;he.isClimbing&&Me.pitch<-0&&(e*=-1);n=e*Kt*Se/1e3;he.isClimbing?(Me.y+=-1*n,Me.y<Xt&&(Me.y=Xt,he.isClimbing=!1),he.isClimbing&&Me.y>Pe.height+10&&(Me.y=Pe.height+10)):(Me.z+=n*Math.cos(Me.yaw),Me.x+=n*Math.sin(Me.yaw))}if(0!==he.sideMovement){var n=(e=1===he.sideMovement?1:-1)*Kt*Se/1e3;Me.z+=n*Math.cos(Me.yaw+Math.PI/2),Me.x+=n*Math.sin(Me.yaw+Math.PI/2)}var r=P({x:Me.x,y:0,z:Me.z});r&&"tree"===r.type&&(Me.x=t.x,Me.y=t.y,Me.z=t.z),Y()&&"won"!==Ne&&Ut(),he.health<=0&&"died"!==Ne&&Ct(),W().forEach(function(t){t.cooldown||(J(),t.cooldown=!0,setTimeout(function(){t.cooldown=!1},1e3*Ht))})}function J(){ve||(he.health-=1,ge.play("monster-hit"),setTimeout(function(){Ee.style.opacity=1,ve=!1},Jt),Ee.style.opacity=.4)}function Q(){var t=Me.pitch+ie/2+ie/2,e=Me.yaw;le.lasers.push({x:Me.x+Math.sin(e)*Math.sin(t)*Wt+Math.sin(e+ie/4)*Wt,y:Me.y+Math.cos(t)*Wt,z:Me.z+Math.cos(e)*Math.sin(t)*Wt+Math.cos(e+ie/4)*Wt,pitch:Me.pitch,yaw:Me.yaw,expire:1e3*(new Date/1e3+Vt)}),ge.play("laser")}function Z(){this.sounds={}}function $(){pe=new AudioContext}function tt(){de&&de.close(),de=new AudioContext}function et(){be&&clearTimeout(be),tt()}function nt(t,e){var n=0,r=[];be&&clearTimeout(be),tt();for(var i=0;i<1;i++)r=r.concat(xe[t].notes);r.forEach(function(t,r){var i=t[0],o=t[1],a=t[2];rt(i,n,o,e,de),n+=a}),be=setTimeout(function(){nt(t,e)},1e3*n)}function rt(t,e,n,r,i,o,a){var c=i.createOscillator(),u=i.createGain();u.connect(i.destination),c.connect(u),c.frequency.value=t,c.type=a||"square",u.gain.value=r,"ease-in"===o?(u.gain.setValueAtTime(0,i.currentTime),u.gain.linearRampToValueAtTime(r,i.currentTime+e+n)):"ease-out"===o?u.gain.linearRampToValueAtTime(0,i.currentTime+e+n):"ease-in-out"===o&&(u.gain.setValueAtTime(0,i.currentTime),u.gain.linearRampToValueAtTime(r,i.currentTime+e+.5*n),u.gain.linearRampToValueAtTime(0,i.currentTime+e+n)),c.start(i.currentTime+e),c.stop(i.currentTime+e+n)}function it(){Ee.width=window.innerWidth,Ee.height=window.innerHeight,u(w(),U()),lt(function(){St()})}function ot(t){var e=document.createElement("canvas");e.width=16,e.height=16;for(var r=e.getContext("2d"),i=0;i<16;i++)for(var o=0;o<16;o++)r.save(),r.fillStyle="#"+n(t),r.fillRect(i,o,2,2),r.restore();return e.toDataURL()}function at(){Re.innerHTML="EVIL WOOD<br><br>YOU ARE LOST IN AN EVIL FOREST<br>CLIMB TREES TO SEE THE SKY<br>LET THE NORTH STAR GUIDE YOU<br>FIND THE RED FAIRY TO ESCAPE<br>BEWARE THE DARK SOULS<br><br>"+ye+"<br><br>CLICK SCREEN TO START",Ue=(new Date).getTime()}function ct(){Re.innerHTML="PAUSED<br><br>"+ye+"<br>CLICK SCREEN TO CONTINUE",Ue=(new Date).getTime()}function ut(){Re.innerHTML="YOU WIN!<br><br>CONGRATULATIONS ON ESCAPING EVIL WOOD<br>YOUR CUNNING, SKILL, AND BRAVERY<br>WILL BE REMEMBERED FOR ALL TIME<br><br>CLICK SCREEN TO PLAY AGAIN",Ue=(new Date).getTime()}function st(){Re.innerHTML="YOU DIED<br><br>DARK SOULS DEVOUR YOUR BODY<br>DARKNESS FALLS AND EVIL WOOD FADES AWAY<br>YOUR HORRIFIC FATE IS LOST FOREVER<br><br>CLICK SCREEN TO TRY AGAIN",Ue=(new Date).getTime()}function ft(){Re.innerHTML=""}function lt(t){Le={tree:{encoding:ot(["4a493b","534e3e","3d3527","524534","46433b","443e2b","271c10"])},ground:{encoding:ot(["2c2e20","282e26","303e1a","444b31","393c2c","33352f","333435","2c2e23","3d3f36","3d3a30","464339","514938","6a6554"])},leaves:{encoding:ot(["51531f","4e5315","545617","4c4d13","252108","33370a","474d13","383c0d"])},red:{encoding:ot(["ff0000"])},shadow:{encoding:ot(["000000"])},monster:{encoding:ot(["5f3b88","56367e","4d3279","553783","412d6f","3b2866","4b337a","563986","4e3179","54367f","663f8f","382460"])},orange:{encoding:ot(["ffcc00"])},white:{encoding:ot(["ffffff"])}};var e=0,n=0;for(var r in Le)!function(){n++;var i=Le[r],o=i.glTexture=Te.createTexture(),a=i.image=new Image;a.onload=function(){b(o,a),++e>=n&&t()},a.src=i.encoding}()}function mt(){var t=le.beacon;if("won"!==Ne){o(),l(t.x,t.y,t.z),m(t.rotationY,0,1,0),E(ze.cube,Le.red.glTexture,!1),A(ze.cube),a(),o(),l(t.x,-1.99,t.z),m(t.rotationY,0,1,0),E(ze.cube,Le.shadow.glTexture,!0),A(ze.cube),a();var e=Dt.create([t.x-Me.x,0,t.z-Me.z]);Dt.normalize(e),o(),l(Me.x,140,Me.z),l(e[0]*jt,0,e[2]*jt),E(ze.cube,Le.orange.glTexture,!1),A(ze.cube),a()}}function ht(){le.monsters.forEach(function(t){var e=t.isHit?"white":"monster";t.points.forEach(function(t){o(),l(t.x,t.y,t.z),E(ze.cube,Le[e].glTexture,!0),A(ze.cube),a()})})}function vt(t,e){o(),l(t*Ce,-1.1,e*Ce),E(ze.plane,Le.ground.glTexture,!0),A(ze.plane),a()}function gt(t,e){if(le.blocks[t]&&le.blocks[t][e])for(var n=le.blocks[t][e].trees,r=0;r<n.length;r++){var i=n[r];i.points.forEach(function(t){o(),l(t.x,t.y,t.z),m(i.rotationY,0,1,0),h(2,2,2),E(ze.cube,Le.tree.glTexture,!0),A(ze.cube),a()});var c=i.points[i.points.length-1],u=c.x,s=c.y,f=c.z;fe.forEach(function(t){o(),l(u+8*t[0],s+8*t[2],f+8*t[1]),h(4,4,4),E(ze.cube,Le.leaves.glTexture,!0),A(ze.cube),a()})}}function dt(){for(var t="",e=0;e<he.health;e++)t+="<span>&hearts;</span>";we.innerHTML=t}function pt(){q().forEach(function(t){var e=t.x,n=t.z;vt(e,n),gt(e,n)})}function bt(){le.lasers.forEach(function(t){o(),l(t.x,t.y,t.z),m(t.yaw,0,1,0),m(t.pitch,1,0,0),h(.2,.2,5),E(ze.cube,Le.orange.glTexture,!1),A(ze.cube),a()})}function xt(){i(),s(45,.1,150),f(),M(),L(0,0,0),R(.9,.9,.9),m(-Me.pitch,1,0,0),m(-Me.yaw,0,1,0),l(-Me.x,-Me.y,-Me.z),dt(),pt(),mt(),ht(),bt()}function yt(){Me={x:0,y:Xt,z:0,pitch:0,yaw:0},C(),X(),Ne="menu",nt("menu",.4),at()}function Et(t){switch(t.which||t.keyCode){case 65:"playing"!==Ne||he.isClimbing||(he.sideMovement=-1);break;case 87:"playing"===Ne&&(he.straightMovement=1);break;case 68:"playing"!==Ne||he.isClimbing||(he.sideMovement=1);break;case 83:"playing"===Ne&&(he.straightMovement=-1);break;case 32:"playing"!==Ne||he.isClimbing||(Pe=V())&&(he.isClimbing=!0,Me.y+=Qt)}}function Tt(t){switch(t.which||t.keyCode){case 65:he.sideMovement=0;break;case 87:he.straightMovement=0;break;case 68:he.sideMovement=0;break;case 83:he.straightMovement=0}}function At(t){Mt()&&(Me.pitch+=t.movementY*ie*.001*-1,Me.pitch>ie/2&&(Me.pitch=ie/2),Me.pitch<-1*ie/2&&(Me.pitch=-1*ie/2),Me.yaw+=t.movementX*ie*.001*-1)}function Mt(){return document.pointerLockElement===Ee}function Lt(t){var e=(new Date).getTime();"playing"===Ne?Q():e>Ue+1e3*$t&&("menu"===Ne||"paused"===Ne?Rt():"playing"===Ne?Q():"won"!==Ne&&"died"!==Ne||yt())}function Rt(){Ne="playing",Ee.requestPointerLock(),ft(),et(),ge.play("start")}function wt(){Ne="paused",nt("menu",.4),ct()}function Ut(){ge.play("player-win"),document.exitPointerLock(),Ne="won",ut(),setTimeout(function(){nt("menu",.4)},1e3)}function Ct(){document.exitPointerLock(),Ne="died",nt("menu",.4),st(),ge.play("player-die")}function zt(){document.addEventListener("keydown",function(t){Et(t)},!1),document.addEventListener("keyup",function(t){Tt(t)},!1),document.addEventListener("mousemove",function(t){At(t)},!1),document.addEventListener("mousedown",function(t){Lt(t)},!1),document.addEventListener("pointerlockchange",function(t){Mt()||"playing"!==Ne||wt()},!1)}function St(){Ie=(new Date).getTime(),0!==De&&(Se=Ie-De),"playing"===Ne&&(j(),I(),D(),S(),K(!0)),xt(),De=Ie,window.requestAnimationFrame(St)}glMatrixArrayType="undefined"!=typeof Float32Array?Float32Array:"undefined"!=typeof WebGLFloatArray?WebGLFloatArray:Array;var Dt={};Dt.create=function(t){var e=new glMatrixArrayType(3);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2]),e},Dt.scale=function(t,e,n){return n&&t!=n?(n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n):(t[0]*=e,t[1]*=e,t[2]*=e,t)},Dt.normalize=function(t,e){e||(e=t);var n=t[0],r=t[1],i=t[2],o=Math.sqrt(n*n+r*r+i*i);return o?1==o?(e[0]=n,e[1]=r,e[2]=i,e):(o=1/o,e[0]=n*o,e[1]=r*o,e[2]=i*o,e):(e[0]=0,e[1]=0,e[2]=0,e)},Dt.direction=function(t,e,n){n||(n=t);var r=t[0]-e[0],i=t[1]-e[1];return t=t[2]-e[2],(e=Math.sqrt(r*r+i*i+t*t))?(e=1/e,n[0]=r*e,n[1]=i*e,n[2]=t*e,n):(n[0]=0,n[1]=0,n[2]=0,n)};var It={};It.create=function(t){var e=new glMatrixArrayType(9);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9]),e},It.transpose=function(t,e){if(!e||t==e){var n=t[1],r=t[2],i=t[5];return t[1]=t[3],t[2]=t[6],t[3]=n,t[5]=t[7],t[6]=r,t[7]=i,t}return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],e};var Nt={};Nt.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Nt.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Nt.create=function(t){var e=new glMatrixArrayType(16);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e},Nt.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Nt.toMat3=function(t,e){return e||(e=It.create()),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},Nt.toInverseMat3=function(t,e){var n=t[0],r=t[1],i=t[2],o=t[4],a=t[5],c=t[6],u=t[8],s=t[9],f=t[10],l=f*a-c*s,m=-f*o+c*u,h=s*o-a*u,v=n*l+r*m+i*h;return v?(v=1/v,e||(e=It.create()),e[0]=l*v,e[1]=(-f*r+i*s)*v,e[2]=(c*r-i*a)*v,e[3]=m*v,e[4]=(f*n-i*u)*v,e[5]=(-c*n+i*o)*v,e[6]=h*v,e[7]=(-s*n+r*u)*v,e[8]=(a*n-r*o)*v,e):null},Nt.multiply=function(t,e,n){n||(n=t);var r=t[0],i=t[1],o=t[2],a=t[3],c=t[4],u=t[5],s=t[6],f=t[7],l=t[8],m=t[9],h=t[10],v=t[11],g=t[12],d=t[13],p=t[14];t=t[15];var b=e[0],x=e[1],y=e[2],E=e[3],T=e[4],A=e[5],M=e[6],L=e[7],R=e[8],w=e[9],U=e[10],C=e[11],z=e[12],S=e[13],D=e[14];return e=e[15],n[0]=b*r+x*c+y*l+E*g,n[1]=b*i+x*u+y*m+E*d,n[2]=b*o+x*s+y*h+E*p,n[3]=b*a+x*f+y*v+E*t,n[4]=T*r+A*c+M*l+L*g,n[5]=T*i+A*u+M*m+L*d,n[6]=T*o+A*s+M*h+L*p,n[7]=T*a+A*f+M*v+L*t,n[8]=R*r+w*c+U*l+C*g,n[9]=R*i+w*u+U*m+C*d,n[10]=R*o+w*s+U*h+C*p,n[11]=R*a+w*f+U*v+C*t,n[12]=z*r+S*c+D*l+e*g,n[13]=z*i+S*u+D*m+e*d,n[14]=z*o+S*s+D*h+e*p,n[15]=z*a+S*f+D*v+e*t,n},Nt.translate=function(t,e,n){var r=e[0],i=e[1];if(e=e[2],!n||t==n)return t[12]=t[0]*r+t[4]*i+t[8]*e+t[12],t[13]=t[1]*r+t[5]*i+t[9]*e+t[13],t[14]=t[2]*r+t[6]*i+t[10]*e+t[14],t[15]=t[3]*r+t[7]*i+t[11]*e+t[15],t;var o=t[0],a=t[1],c=t[2],u=t[3],s=t[4],f=t[5],l=t[6],m=t[7],h=t[8],v=t[9],g=t[10],d=t[11];return n[0]=o,n[1]=a,n[2]=c,n[3]=u,n[4]=s,n[5]=f,n[6]=l,n[7]=m,n[8]=h,n[9]=v,n[10]=g,n[11]=d,n[12]=o*r+s*i+h*e+t[12],n[13]=a*r+f*i+v*e+t[13],n[14]=c*r+l*i+g*e+t[14],n[15]=u*r+m*i+d*e+t[15],n},Nt.scale=function(t,e,n){var r=e[0],i=e[1];return e=e[2],n&&t!=n?(n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n[3]=t[3]*r,n[4]=t[4]*i,n[5]=t[5]*i,n[6]=t[6]*i,n[7]=t[7]*i,n[8]=t[8]*e,n[9]=t[9]*e,n[10]=t[10]*e,n[11]=t[11]*e,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n):(t[0]*=r,t[1]*=r,t[2]*=r,t[3]*=r,t[4]*=i,t[5]*=i,t[6]*=i,t[7]*=i,t[8]*=e,t[9]*=e,t[10]*=e,t[11]*=e,t)},Nt.rotate=function(t,e,n,r){var i=n[0],o=n[1];n=n[2];var a=Math.sqrt(i*i+o*o+n*n);if(!a)return null;1!=a&&(i*=a=1/a,o*=a,n*=a);var c=Math.sin(e),u=Math.cos(e),s=1-u;e=t[0],a=t[1];var f=t[2],l=t[3],m=t[4],h=t[5],v=t[6],g=t[7],d=t[8],p=t[9],b=t[10],x=t[11],y=i*i*s+u,E=o*i*s+n*c,T=n*i*s-o*c,A=i*o*s-n*c,M=o*o*s+u,L=n*o*s+i*c,R=i*n*s+o*c;return i=o*n*s-i*c,o=n*n*s+u,r?t!=r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]):r=t,r[0]=e*y+m*E+d*T,r[1]=a*y+h*E+p*T,r[2]=f*y+v*E+b*T,r[3]=l*y+g*E+x*T,r[4]=e*A+m*M+d*L,r[5]=a*A+h*M+p*L,r[6]=f*A+v*M+b*L,r[7]=l*A+g*M+x*L,r[8]=e*R+m*i+d*o,r[9]=a*R+h*i+p*o,r[10]=f*R+v*i+b*o,r[11]=l*R+g*i+x*o,r},Nt.frustum=function(t,e,n,r,i,o,a){a||(a=Nt.create());var c=e-t,u=r-n,s=o-i;return a[0]=2*i/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*i/u,a[6]=0,a[7]=0,a[8]=(e+t)/c,a[9]=(r+n)/u,a[10]=-(o+i)/s,a[11]=-1,a[12]=0,a[13]=0,a[14]=-o*i*2/s,a[15]=0,a},Nt.perspective=function(t,e,n,r,i){return t=n*Math.tan(t*Math.PI/360),e*=t,Nt.frustum(-e,e,-t,t,n,r,i)};var Pt=new function(){this._params=new t;var e,n,r,i,o,a,c,u,s,f,l,m;this.reset=function(){var t=this._params;i=100/(t.f*t.f+.001),o=100/(t.g*t.g+.001),a=1-t.h*t.h*t.h*.01,c=-t.i*t.i*t.i*1e-6,t.a||(l=.5-t.n/2,m=5e-5*-t.o),u=1+t.l*t.l*(t.l>0?-.9:10),s=0,f=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},this.totalReset=function(){this.reset();var t=this._params;return e=t.b*t.b*1e5,n=t.c*t.c*1e5,r=t.e*t.e*1e5+12,3*((e+n+r)/3|0)},this.synthWave=function(t,h){var v=this._params,g=1!=v.s||v.v,d=v.v*v.v*.1,p=1+3e-4*v.w,b=v.s*v.s*v.s*.1,x=1+1e-4*v.t,y=1!=v.s,E=v.x*v.x,T=v.g,A=v.q||v.r,M=v.r*v.r*v.r*.2,L=v.q*v.q*(v.q<0?-1020:1020),R=v.p?32+((1-v.p)*(1-v.p)*2e4|0):0,w=v.d,U=v.j/2,C=v.k*v.k*.01,z=v.a,S=e,D=1/e,I=1/n,N=1/r,P=5/(1+v.u*v.u*20)*(.01+b);P>.8&&(P=.8),P=1-P;for(var O,_,k,F,Y,B,V=!1,W=0,H=0,G=0,q=0,K=0,X=0,j=0,J=0,Q=0,Z=0,$=new Array(1024),tt=new Array(32),et=$.length;et--;)$[et]=0;for(et=tt.length;et--;)tt[et]=2*Math.random()-1;for(et=0;et<h;et++){if(V)return et;if(R&&++Q>=R&&(Q=0,this.reset()),f&&++s>=f&&(f=0,i*=u),a+=c,(i*=a)>o&&(i=o,T>0&&(V=!0)),_=i,U>0&&(Z+=C,_*=1+Math.sin(Z)*U),(_|=0)<8&&(_=8),z||((l+=m)<0?l=0:l>.5&&(l=.5)),++H>S)switch(H=0,++W){case 1:S=n;break;case 2:S=r}switch(W){case 0:G=H*D;break;case 1:G=1+2*(1-H*I)*w;break;case 2:G=1-H*N;break;case 3:G=0,V=!0}A&&((k=0|(L+=M))<0?k=-k:k>1023&&(k=1023)),g&&p&&((d*=p)<1e-5?d=1e-5:d>.1&&(d=.1)),B=0;for(var nt=8;nt--;){if(++j>=_&&(j%=_,3==z))for(var rt=tt.length;rt--;)tt[rt]=2*Math.random()-1;switch(z){case 0:Y=j/_<l?.5:-.5;break;case 1:Y=1-j/_*2;break;case 2:Y=.225*(((Y=1.27323954*(F=6.28318531*((F=j/_)>.5?F-1:F))+.405284735*F*F*(F<0?1:-1))<0?-1:1)*Y*Y-Y)+Y;break;case 3:Y=tt[Math.abs(32*j/_|0)]}g&&(O=X,(b*=x)<0?b=0:b>.1&&(b=.1),y?(K+=(Y-X)*b,K*=P):(X=Y,K=0),q+=(X+=K)-O,Y=q*=1-d),A&&($[J%1024]=Y,Y+=$[(J-k+1024)%1024],J++),B+=Y}B*=.125*G*E,t[et]=B>=1?32767:B<=-1?-32768:32767*B|0}return h}};window.jsfxr=function(t){Pt._params.setSettings(t);var e=Pt.totalReset(),n=new Uint8Array(4*((e+1)/2|0)+44),r=2*Pt.synthWave(new Uint16Array(n.buffer,44),e),i=new Uint32Array(n.buffer,0,44);i[0]=1179011410,i[1]=r+36,i[2]=1163280727,i[3]=544501094,i[4]=16,i[5]=65537,i[6]=44100,i[7]=88200,i[8]=1048578,i[9]=1635017060,i[10]=r,r+=44;for(var o=0,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c="data:audio/wav;base64,";o<r;o+=3){var u=n[o]<<16|n[o+1]<<8|n[o+2];c+=a[u>>18]+a[u>>12&63]+a[u>>6&63]+a[63&u]}return c};var Ot=10,_t=.5,kt=1e3,Ft=10,Yt=2,Bt=350,Vt=1,Wt=2,Ht=1,Gt=10,qt=25,Kt=40,Xt=6,jt=100,Jt=100,Qt=11,Zt=.5,$t=.5,te=.015,ee=100,ne=50,re=100,ie=Math.PI,oe=Math.round,ae=Math.random,ce=Nt.create(),ue=Nt.create(),se=[],fe=[[-1,-2,-2],[0,-2,-2],[1,-2,-2],[-2,-1,-2],[-1,-1,-1],[0,-1,-1],[1,-1,-1],[2,-1,-2],[-2,0,-2],[-1,0,-1],[1,0,-1],[2,0,-2],[-2,1,-2],[-1,1,-1],[0,1,-1],[1,1,-1],[2,1,-2],[-1,2,-2],[0,2,-2],[1,2,-2],[0,0,0]],le={},me=0,he={},ve=!1;Z.prototype.add=function(t,e,n){this.sounds[t]=[],n.forEach(function(n,r){this.sounds[t].push({tick:0,count:e,pool:[]});for(var i=0;i<e;i++){var o=new Audio;o.src=jsfxr(n),this.sounds[t][r].pool.push(o)}},this)},Z.prototype.play=function(t,e){var n=this.sounds[t],r=n.length>1?n[Math.floor(Math.random()*n.length)]:n[0];r.pool[r.tick].volume=e||1,r.pool[r.tick].play(),r.tick<r.count-1?r.tick++:r.tick=0};var ge=new Z;ge.add("laser",5,[[0,,.15,.5099,.2743,.9399,.2726,-.36,.0599,.27,.1299,.14,.4499,.4699,-.3199,,-.0399,-.4199,1,,,.0599,.0199,.5]]),ge.add("damage",5,[[3,,.1426,.3949,.4827,.1746,,-.0503,,,,,,,,,,,1,,,,,.38],[3,,.2189,.7895,.1358,.1205,,-.2385,,,,,,,,,.2261,-.144,1,,,,,.38],[3,,.1728,.4996,.2668,.0808,,.1381,,,,,,,,,.4345,-.0425,1,,,,,.38],[3,,.3191,.5696,.3516,.775,,-.3272,,,,.6291,.7188,,,.6283,,,1,,,,,.38]]),ge.add("monster-hit",5,[[3,,.356,.76,.47,.1,,.24,,.85,.66,,,,,,.0291,-.1671,1,,,,,.79]]),ge.add("monster-die",2,[[3,.1,.42,.4274,.2192,.1281,,-.18,.04,,,-.14,,,,,-.04,-.1999,1,-.0999,,,-.0999,.72]]),ge.add("start",1,[[2,.4045,.2127,.6091,.5411,.552,,-.7327,.0561,.0021,,-.5946,,.2111,-.9549,.8694,.0593,-.6822,.9964,-.3453,.4295,.4381,,.97]]),ge.add("monster-jump",3,[[3,.0799,.2099,,.4399,.4099,,.0199,.14,.1,.0799,.1,.2599,.2891,.134,,-.8799,.56,.1,.18,.81,.18,.5199,.93]]),ge.add("player-die",1,[[3,,.1099,.3199,1,.23,,.4,-.34,,,-.4799,.9499,,.0281,.2099,-.1199,-.1599,.9952,.1272,.37,,.0736,.86]]),ge.add("player-win",1,[[0,,.01,,1,.23,,.1599,-.0399,.8,.5,-.0199,,.3899,-.0199,,,,.91,-.0599,.18,.1099,,.5699]]);var de,pe,be=null,xe={menu:{notes:[[61.74,.13,.15],[61.74,.13,.3],[61.74,.13,.3],[61.74,.13,.15],[61.74,.13,.15],[61.74,.13,.15],[61.74,.13,.3],[61.74,.13,.3],[61.74,.13,.6],[51.91,.13,.15],[51.91,.13,.3],[51.91,.13,.3],[51.91,.13,.15],[51.91,.13,.15],[51.91,.13,.15],[51.91,.13,.3],[51.91,.13,.3],[51.91,.13,.6],[41.2,.13,.15],[41.2,.13,.3],[41.2,.13,.3],[41.2,.13,.15],[41.2,.13,.15],[41.2,.13,.15],[41.2,.13,.3],[41.2,.13,.3],[41.2,.13,.6],[61.74,.13,.15],[61.74,.13,.3],[61.74,.13,.3],[61.74,.13,.15],[61.74,.13,.15],[61.74,.13,.15],[61.74,.13,.3],[61.74,.13,.3],[61.74,.13,.6]]},play:{notes:[[65.41,.3,.5],[65.41,.3,.5],[65.41,.15,.25],[69.3,.15,.25],[65.41,.3,.5],[65.41,.15,.25],[69.3,.15,.25],[65.41,.15,.25],[61.74,.15,.25],[65.41,.3,1]]}},ye="[WASD]&nbsp; MOVE AROUND&nbsp;&nbsp;&nbsp;<br>[CLICK] SHOOT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>[SPACE] CLIMB TREE &nbsp;&nbsp;&nbsp;<br>[ESC]&nbsp;&nbsp; PAUSE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>",Ee=document.getElementById("scene"),Te=Ee.getContext("webgl"),Ae=Te.createProgram(),Me={},Le={},Re=document.getElementById("a"),we=document.getElementById("b"),Ue=0,Ce=100,ze={cube:{position:x([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),normal:x([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),texture:x([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),index:y([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23])},plane:{position:x([-Ce/2,0,-Ce/2,-Ce/2,0,Ce/2,Ce/2,0,Ce/2,Ce/2,0,-Ce/2]),normal:x([0,1,0,0,1,0,0,1,0,0,1,0]),texture:x([0,Ce/4,0,0,Ce/4,0,Ce/4,Ce/4]),index:y([0,1,2,0,2,3])}},Se=0,De=0,Ie=0,Ne="menu",Pe=null;r(),yt(),it(),$(),zt()}();</script>
</body>
</html>